{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"CMDR Documentation","text":"<p>CMDR is a simple command version management tool that helps you quickly switch between multiple command versions.</p>"},{"location":"#what-is-cmdr","title":"What is CMDR?","text":"<p>CMDR (Command Manager) solves a common developer problem: managing multiple versions of CLI tools. Whether you need different versions of <code>node</code>, <code>python</code>, <code>go</code>, or any other command-line tool, CMDR provides a unified interface to:</p> <ul> <li>Install commands from URLs or local paths</li> <li>Switch between different versions seamlessly</li> <li>List all installed versions of a command</li> <li>Activate/Deactivate specific versions</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code># Install a command version\ncmdr command install -n kubectl -v 1.28.0 -l https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl\n\n# List installed versions\ncmdr command list -n kubectl\n\n# Switch to a specific version\ncmdr command use -n kubectl -v 1.28.0\n</code></pre>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Version Management: Install and switch between multiple versions of any command</li> <li>URL Replacement: Speed up downloads by configuring proxy URLs<sup>1</sup></li> <li>Self-Upgrade: Update CMDR itself with a single command</li> <li>Cross-Platform: Works on Linux and macOS</li> </ul>"},{"location":"#documentation-structure","title":"Documentation Structure","text":"Section Description Getting Started Installation and first steps Architecture System design and internals Components Detailed component documentation API Interface and configuration reference Operations Build, test, and release processes"},{"location":"#technology-stack","title":"Technology Stack","text":"<p>CMDR is built with Go 1.25 and uses:</p> <ul> <li>Cobra - CLI framework<sup>2</sup></li> <li>Viper - Configuration management<sup>2</sup></li> <li>Storm - BoltDB wrapper for data persistence<sup>3</sup></li> <li>go-getter - URL-based file fetching<sup>4</sup></li> </ul> <ol> <li> <p>See URL replacement feature in <code>cmd/root.go</code> L166-L179\u00a0\u21a9</p> </li> <li> <p>CLI setup in <code>cmd/root.go</code> L20-L56\u00a0\u21a9\u21a9</p> </li> <li> <p>Database initialization in <code>cmd/root.go</code> L147-L164\u00a0\u21a9</p> </li> <li> <p>Fetcher implementation in <code>core/fetcher/go_getter.go</code> \u21a9</p> </li> </ol>"},{"location":"adr/","title":"Architecture Decision Records","text":"<p>This section will contain Architecture Decision Records (ADRs) documenting key architectural decisions made during CMDR development.</p>"},{"location":"adr/#what-are-adrs","title":"What are ADRs?","text":"<p>Architecture Decision Records document important architectural decisions made in a project, including:</p> <ul> <li>The context and problem being addressed</li> <li>The decision that was made</li> <li>The rationale behind the decision</li> <li>The consequences of the decision</li> </ul>"},{"location":"adr/#adr-format","title":"ADR Format","text":"<p>Each ADR should follow this template:</p> <pre><code># ADR-XXXX: Title\n\n**Status:** Proposed | Accepted | Deprecated | Superseded\n\n**Date:** YYYY-MM-DD\n\n## Context\n\nWhat is the issue that we're seeing that is motivating this decision or change?\n\n## Decision\n\nWhat is the change that we're proposing and/or doing?\n\n## Rationale\n\nWhy did we choose this option over alternatives?\n\n## Consequences\n\nWhat becomes easier or more difficult to do because of this change?\n\n### Positive\n\n- Benefit 1\n- Benefit 2\n\n### Negative\n\n- Drawback 1\n- Drawback 2\n\n## Alternatives Considered\n\nWhat other options were considered and why were they rejected?\n</code></pre>"},{"location":"adr/#existing-adrs","title":"Existing ADRs","text":"<p>Currently, there are no formal ADRs documented. However, some implicit architectural decisions can be inferred from the codebase:</p>"},{"location":"adr/#implicit-decision-factory-pattern-for-extensibility","title":"Implicit Decision: Factory Pattern for Extensibility","text":"<p>Context: Need to support multiple implementations of interfaces (CommandManager, Initializer, etc.)</p> <p>Decision: Use factory pattern with registration</p> <p>Rationale: - Decouples interface consumers from implementations - Allows runtime selection of implementations - Enables easy testing with mock implementations</p> <p>Evidence: <code>core/command.go</code>, <code>core/initializer.go</code></p>"},{"location":"adr/#implicit-decision-layered-manager-architecture","title":"Implicit Decision: Layered Manager Architecture","text":"<p>Context: Need to separate concerns (download, file management, persistence)</p> <p>Decision: Chain managers where each adds functionality</p> <p>Rationale: - Single Responsibility Principle - Easy to test each layer independently - Flexibility to recombine layers</p> <p>Evidence: DownloadManager \u2192 BinaryManager \u2192 DatabaseManager</p>"},{"location":"adr/#implicit-decision-stormboltdb-for-persistence","title":"Implicit Decision: Storm/BoltDB for Persistence","text":"<p>Context: Need lightweight, embedded database for command metadata</p> <p>Decision: Use Storm (wrapper around BoltDB)</p> <p>Rationale: - No external database required - Single file database - Strong typing with Storm ORM - Cross-platform compatibility</p> <p>Evidence: <code>core/manager/database.go</code></p>"},{"location":"adr/#future-adrs","title":"Future ADRs","text":"<p>Future architectural decisions should be documented as formal ADRs in this directory, such as:</p> <ul> <li>ADR-001: Choice of CLI framework (Cobra vs alternatives)</li> <li>ADR-002: Configuration management approach (Viper)</li> <li>ADR-003: Download strategy pattern</li> <li>ADR-004: Shell initialization approach</li> <li>ADR-005: Version normalization strategy</li> </ul>"},{"location":"api/configuration-keys/","title":"Configuration Keys","text":"<p>Complete reference of all configuration keys in CMDR.</p>"},{"location":"api/configuration-keys/#core-configuration","title":"Core Configuration","text":"Key Default Type Description <code>core.root_dir</code> <code>~/.cmdr</code> string Root directory for CMDR data <code>core.bin_dir</code> <code>bin</code> string Directory for active command symlinks (relative to root) <code>core.shims_dir</code> <code>shims</code> string Directory for command version binaries (relative to root) <code>core.profile_dir</code> <code>profile</code> string Directory for shell initialization scripts (relative to root) <code>core.database_path</code> <code>cmdr.db</code> string Path to BoltDB database (relative to root) <code>core.profile_path</code> (auto-detected) string Path to shell profile file (~/.bashrc, ~/.zshrc, etc.) <code>core.shell</code> (auto-detected) string Current shell executable <code>core.config_path</code> <code>~/.cmdr/config.yaml</code> string Configuration file path <code>core.link_mode</code> <code>default</code> string How to link binaries: <code>copy</code> or <code>link</code> <p>Source: <code>core/config.go</code> L23-L34</p>"},{"location":"api/configuration-keys/#logging-configuration","title":"Logging Configuration","text":"Key Default Type Description <code>log.level</code> <code>info</code> string Log level: <code>trace</code>, <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code> <code>log.output</code> <code>stderr</code> string Log output: <code>stdout</code> or <code>stderr</code> <p>Source: <code>core/config.go</code> L40-L42</p>"},{"location":"api/configuration-keys/#proxy-configuration","title":"Proxy Configuration","text":"Key Default Type Description <code>proxy.go</code> - string Go module proxy URL (sets <code>GOPROXY</code>) <code>proxy.http</code> - string HTTP proxy URL (sets <code>HTTP_PROXY</code>) <code>proxy.https</code> - string HTTPS proxy URL (sets <code>HTTPS_PROXY</code>) <p>Source: <code>core/config.go</code> L35-L38</p>"},{"location":"api/configuration-keys/#download-configuration","title":"Download Configuration","text":""},{"location":"api/configuration-keys/#general","title":"General","text":"Key Default Type Description <code>download.replace</code> - object Legacy URL replacement pattern <p>Source: <code>core/config.go</code> L44-L45</p>"},{"location":"api/configuration-keys/#direct-strategy","title":"Direct Strategy","text":"Key Default Type Description <code>download.direct.timeout</code> 30 int Timeout in seconds <code>download.direct.max_retries</code> 3 int Maximum retry attempts <p>Source: <code>core/config.go</code> L48-L49</p>"},{"location":"api/configuration-keys/#proxy-strategy","title":"Proxy Strategy","text":"Key Default Type Description <code>download.proxy.enabled</code> false bool Enable proxy strategy <code>download.proxy.type</code> <code>http</code> string Proxy type: <code>http</code> or <code>socks5</code> <code>download.proxy.address</code> - string Proxy server address <code>download.proxy.timeout</code> 30 int Timeout in seconds <code>download.proxy.max_retries</code> 3 int Maximum retry attempts <p>Source: <code>core/config.go</code> L51-L55</p>"},{"location":"api/configuration-keys/#rewrite-strategy","title":"Rewrite Strategy","text":"Key Default Type Description <code>download.rewrite.rule</code> - string URL rewrite template <p>Source: <code>core/config.go</code> L57</p>"},{"location":"api/configuration-keys/#cli-command-configuration","title":"CLI Command Configuration","text":"<p>These keys are transient, used only during command execution:</p>"},{"location":"api/configuration-keys/#command-install","title":"command install","text":"Key CLI Flag Description <code>_.command.install.name</code> <code>-n, --name</code> Command name <code>_.command.install.version</code> <code>-v, --version</code> Version string <code>_.command.install.location</code> <code>-l, --location</code> Download URL or file path <code>_.command.install.activate</code> <code>-a, --activate</code> Activate after install <p>Source: <code>core/config.go</code> L65-L68</p>"},{"location":"api/configuration-keys/#command-define","title":"command define","text":"Key CLI Flag Description <code>_.command.define.name</code> <code>-n, --name</code> Command name <code>_.command.define.version</code> <code>-v, --version</code> Version string <code>_.command.define.location</code> <code>-l, --location</code> File path <code>_.command.define.activate</code> <code>-a, --activate</code> Activate after define <p>Source: <code>core/config.go</code> L60-L63</p>"},{"location":"api/configuration-keys/#command-list","title":"command list","text":"Key CLI Flag Description <code>_.command.list.name</code> <code>-n, --name</code> Filter by name <code>_.command.list.version</code> <code>-v, --version</code> Filter by version <code>_.command.list.location</code> <code>-l, --location</code> Filter by location <code>_.command.list.activate</code> <code>-a, --activate</code> Filter by activation <code>_.command.list.fields</code> <code>--fields</code> Fields to display <p>Source: <code>core/config.go</code> L70-L74</p>"},{"location":"api/configuration-keys/#command-remove","title":"command remove","text":"Key CLI Flag Description <code>_.command.remove.name</code> <code>-n, --name</code> Command name <code>_.command.remove.version</code> <code>-v, --version</code> Version to remove <p>Source: <code>core/config.go</code> L76-L77</p>"},{"location":"api/configuration-keys/#command-unset","title":"command unset","text":"Key CLI Flag Description <code>_.command.unset.name</code> <code>-n, --name</code> Command name <p>Source: <code>core/config.go</code> L79</p>"},{"location":"api/configuration-keys/#command-use","title":"command use","text":"Key CLI Flag Description <code>_.command.use.name</code> <code>-n, --name</code> Command name <code>_.command.use.version</code> <code>-v, --version</code> Version to activate <p>Source: <code>core/config.go</code> L81-L82</p>"},{"location":"api/configuration-keys/#config-get","title":"config get","text":"Key CLI Flag Description <code>_.config.get.key</code> <code>-k, --key</code> Configuration key <p>Source: <code>core/config.go</code> L85</p>"},{"location":"api/configuration-keys/#config-set","title":"config set","text":"Key CLI Flag Description <code>_.config.set.key</code> <code>-k, --key</code> Configuration key <code>_.config.set.value</code> <code>-v, --value</code> Configuration value <p>Source: <code>core/config.go</code> L87-L88</p>"},{"location":"api/configuration-keys/#init","title":"init","text":"Key CLI Flag Description <code>_.init.upgrade</code> <code>--upgrade</code> Whether this is an upgrade <p>Source: <code>core/config.go</code> L91</p>"},{"location":"api/configuration-keys/#upgrade","title":"upgrade","text":"Key CLI Flag Description <code>_.upgrade.release</code> <code>-r, --release</code> Release name to upgrade to <code>_.upgrade.asset</code> <code>-a, --asset</code> Asset name to download <code>_.upgrade.args</code> <code>--args</code> Additional arguments <p>Source: <code>core/config.go</code> L94-L96</p>"},{"location":"api/configuration-keys/#environment-variable-mapping","title":"Environment Variable Mapping","text":"<p>All configuration keys can be set via environment variables:</p> <p>Format: <code>CMDR_&lt;KEY&gt;</code> where <code>&lt;KEY&gt;</code> is the config key with <code>.</code> replaced by <code>_</code> and uppercased.</p> <p>Examples:</p> Config Key Environment Variable <code>core.root_dir</code> <code>CMDR_CORE_ROOT_DIR</code> <code>log.level</code> <code>CMDR_LOG_LEVEL</code> <code>download.direct.timeout</code> <code>CMDR_DOWNLOAD_DIRECT_TIMEOUT</code> <code>proxy.http</code> <code>CMDR_PROXY_HTTP</code>"},{"location":"api/configuration-keys/#configuration-file-example","title":"Configuration File Example","text":"<pre><code># ~/.cmdr/config.yaml\n\n# Core settings\ncore:\n  root_dir: ~/.cmdr\n  bin_dir: bin\n  shims_dir: shims\n  profile_dir: profile\n  database_path: cmdr.db\n  link_mode: copy\n\n# Logging\nlog:\n  level: info\n  output: stderr\n\n# Proxy settings\nproxy:\n  go: https://goproxy.cn,direct\n  http: http://proxy.example.com:8080\n  https: http://proxy.example.com:8080\n\n# Download settings\ndownload:\n  # Direct strategy\n  direct:\n    timeout: 30\n    max_retries: 3\n\n  # Proxy strategy\n  proxy:\n    enabled: true\n    type: http\n    address: http://download-proxy.example.com:8080\n    timeout: 60\n    max_retries: 5\n\n  # URL rewrite for GitHub\n  rewrite:\n    rule: \"https://ghproxy.com/{{.URI}}\"\n\n  # Legacy replacement (still supported)\n  replace:\n    match: \"^https://raw.githubusercontent.com/.*$\"\n    template: \"https://ghproxy.com/{{ .input | urlquery }}\"\n</code></pre>"},{"location":"api/core-interfaces/","title":"Core Interfaces","text":"<p>This document provides a reference for all core interfaces in CMDR.</p>"},{"location":"api/core-interfaces/#command-interfaces","title":"Command Interfaces","text":""},{"location":"api/core-interfaces/#command","title":"Command","text":"<p>Read-only view of a managed command<sup>1</sup>:</p> <pre><code>type Command interface {\n    GetName() string        // Command name (e.g., \"kubectl\")\n    GetVersion() string     // Version string (e.g., \"1.28.0\")\n    GetActivated() bool     // Whether this version is activated\n    GetLocation() string    // File path to the binary\n}\n</code></pre>"},{"location":"api/core-interfaces/#commandquery","title":"CommandQuery","text":"<p>Fluent API for querying commands<sup>2</sup>:</p> <pre><code>type CommandQuery interface {\n    WithName(name string) CommandQuery\n    WithVersion(version string) CommandQuery\n    WithActivated(activated bool) CommandQuery\n    WithLocation(location string) CommandQuery\n\n    All() ([]Command, error)   // Get all matching commands\n    One() (Command, error)     // Get first matching command\n    Count() (int, error)       // Count matching commands\n}\n</code></pre> <p>Usage Example:</p> <pre><code>query, _ := manager.Query()\n\n// Find activated kubectl\ncmd, _ := query.WithName(\"kubectl\").WithActivated(true).One()\n\n// List all versions of node\ncommands, _ := query.WithName(\"node\").All()\n\n// Count total managed commands\ncount, _ := query.Count()\n</code></pre>"},{"location":"api/core-interfaces/#commandmanager","title":"CommandManager","text":"<p>Full CRUD operations for commands<sup>3</sup>:</p> <pre><code>type CommandManager interface {\n    Close() error\n    Provider() CommandProvider\n    Query() (CommandQuery, error)\n\n    Define(name, version, location string) (Command, error)\n    Undefine(name, version string) error\n    Activate(name, version string) error\n    Deactivate(name string) error\n}\n</code></pre> <p>Providers:</p> Provider Value Implementation Database <code>CommandProviderDatabase</code> <code>core/manager/database.go</code> Binary <code>CommandProviderBinary</code> <code>core/manager/binary.go</code> Download <code>CommandProviderDownload</code> <code>core/manager/download.go</code> Doctor <code>CommandProviderDoctor</code> <code>core/manager/doctor.go</code>"},{"location":"api/core-interfaces/#initialization-interfaces","title":"Initialization Interfaces","text":""},{"location":"api/core-interfaces/#initializer","title":"Initializer","text":"<p>System initialization tasks<sup>4</sup>:</p> <pre><code>type Initializer interface {\n    Init(isUpgrade bool) error\n}\n</code></pre> <p>Registered Initializers:</p> Key Implementation Purpose <code>\"binary\"</code> <code>BinaryManager</code> Create bin/ and shims/ directories <code>\"profile-dir-backup\"</code> <code>FSBackup</code> Backup profile directory <code>\"profile-dir-export\"</code> <code>EmbedFSExporter</code> Export embedded profile scripts <code>\"profile-dir-render\"</code> <code>DirRender</code> Render profile templates <code>\"profile-injector\"</code> <code>ProfileInjector</code> Inject source line into shell profile <code>\"database\"</code> <code>DatabaseInitializer</code> Initialize database schema <code>\"command\"</code> <code>CommandInitializer</code> Register cmdr as managed command"},{"location":"api/core-interfaces/#download-interfaces","title":"Download Interfaces","text":""},{"location":"api/core-interfaces/#fetcher","title":"Fetcher","text":"<p>File download abstraction<sup>5</sup>:</p> <pre><code>type Fetcher interface {\n    Fetch(source, destination string) error\n}\n</code></pre> <p>Implementations:</p> <ul> <li><code>GoGetterFetcher</code> - Uses HashiCorp go-getter for flexible downloads</li> <li><code>GoFetcher</code> - Specialized for Go module downloads</li> </ul>"},{"location":"api/core-interfaces/#downloadstrategy","title":"DownloadStrategy","text":"<p>Strategy for URL transformationand retry logic:</p> <pre><code>type DownloadStrategy interface {\n    Name() string\n    Prepare(uri string) (string, error)\n    ShouldRetry(err error) bool\n    ShouldFallback(err error) bool\n    Configure(cfg Configuration) error\n    IsEnabled(uri string) bool\n    SetEnabled(enabled bool)\n}\n</code></pre> <p>Implementations:</p> <ul> <li><code>DirectStrategy</code> - Direct downloads</li> <li><code>ProxyStrategy</code> - HTTP/SOCKS5 proxy</li> <li><code>RewriteStrategy</code> - URL rewriting</li> <li><code>ChainStrategy</code> - Chain of strategies with retry/fallback</li> </ul>"},{"location":"api/core-interfaces/#configuration-interface","title":"Configuration Interface","text":""},{"location":"api/core-interfaces/#configuration","title":"Configuration","text":"<p>Type alias for Viper configuration<sup>6</sup>:</p> <pre><code>type Configuration = *viper.Viper\n</code></pre> <p>Common Methods:</p> <pre><code>// Get values\nGetString(key string) string\nGetInt(key string) int\nGetBool(key string) bool\nGetStringSlice(key string) []string\n\n// Set values\nSet(key string, value interface{})\nSetDefault(key string, value interface{})\n\n// Check existence\nIsSet(key string) bool\n\n// Bind flags\nBindPFlag(key string, flag *pflag.Flag) error\n</code></pre>"},{"location":"api/core-interfaces/#database-interface","title":"Database Interface","text":""},{"location":"api/core-interfaces/#database","title":"Database","text":"<p>Abstraction over Storm/BoltDB<sup>7</sup>:</p> <pre><code>type Database interface {\n    Init() error\n    Close() error\n\n    Save(data interface{}) error\n    Select(matchers ...q.Matcher) Query\n    DeleteStruct(data interface{}) error\n}\n</code></pre> <p>Used By: <code>DatabaseManager</code> for persisting command metadata.</p>"},{"location":"api/core-interfaces/#cmdr-searcher-interface","title":"CMDR Searcher Interface","text":""},{"location":"api/core-interfaces/#cmdrsearcher","title":"CmdrSearcher","text":"<p>Search for CMDR releases (for self-upgrade)<sup>8</sup>:</p> <pre><code>type CmdrSearcher interface {\n    GetReleaseAsset(ctx context.Context, releaseName, assetName string) (CmdrReleaseAsset, error)\n}\n\ntype CmdrReleaseAsset struct {\n    Name    string  // Release name\n    Version string  // Version string\n    Asset   string  // Asset name\n    Url     string  // Download URL\n}\n</code></pre> <p>Providers:</p> Provider Source <code>CmdrSearcherProviderApi</code> GitHub API <code>CmdrSearcherProviderAtom</code> GitHub Atom feed"},{"location":"api/core-interfaces/#logger-interface","title":"Logger Interface","text":"<p>CMDR uses logur for logging:</p> <pre><code>type Logger interface {\n    Trace(msg string, fields ...map[string]interface{})\n    Debug(msg string, fields ...map[string]interface{})\n    Info(msg string, fields ...map[string]interface{})\n    Warn(msg string, fields ...map[string]interface{})\n    Error(msg string, fields ...map[string]interface{})\n}\n</code></pre> <p>Usage:</p> <pre><code>logger := core.GetLogger()\nlogger.Info(\"command installed\", map[string]interface{}{\n    \"name\": \"kubectl\",\n    \"version\": \"1.28.0\",\n})\n</code></pre>"},{"location":"api/core-interfaces/#event-bus","title":"Event Bus","text":"<p>Simple publish-subscribe for lifecycle events:</p> <pre><code>func PublishEvent(event string)\nfunc SubscribeEvent(event string, handler func())\n</code></pre> <p>Events:</p> <ul> <li><code>EventExit</code> - Application exit</li> </ul> <p>Usage:</p> <pre><code>// Subscribe\ncore.SubscribeEvent(core.EventExit, func() {\n    // Cleanup\n})\n\n// Publish\ndefer core.PublishEvent(core.EventExit)\n</code></pre> <ol> <li> <p>Command interface in <code>core/command.go</code> L18-L23\u00a0\u21a9</p> </li> <li> <p>CommandQuery interface in <code>core/command.go</code> L25-L34\u00a0\u21a9</p> </li> <li> <p>CommandManager interface in <code>core/command.go</code> L36-L47\u00a0\u21a9</p> </li> <li> <p>Initializer interface in <code>core/initializer.go</code> L5-L7\u00a0\u21a9</p> </li> <li> <p>Fetcher interface in <code>core/fetcher.go</code> \u21a9</p> </li> <li> <p>Configuration type in <code>core/config.go</code> L7\u00a0\u21a9</p> </li> <li> <p>Database interface in <code>core/database.go</code> \u21a9</p> </li> <li> <p>CmdrSearcher interface in <code>core/cmdr.go</code> L18-L20\u00a0\u21a9</p> </li> </ol>"},{"location":"architecture/data-flow/","title":"Data Flow","text":"<p>This document describes how data flows through CMDR during common operations.</p>"},{"location":"architecture/data-flow/#command-installation-flow","title":"Command Installation Flow","text":"<p>When a user runs <code>cmdr command install -n kubectl -v 1.28.0 -l &lt;url&gt;</code>:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    User      \u2502\n\u2502  (CLI input) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     cmd/command/install.go                    \u2502\n\u2502  1. Parse flags (name, version, location)                     \u2502\n\u2502  2. Create DownloadManager from factory                       \u2502\n\u2502  3. Call manager.Define(name, version, location)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  core/manager/download.go                     \u2502\n\u2502  1. Fetch file from URL using Fetcher                         \u2502\n\u2502  2. Validate downloaded binary                                \u2502\n\u2502  3. Delegate to BinaryManager                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   core/manager/binary.go                      \u2502\n\u2502  1. Copy binary to bin directory                              \u2502\n\u2502  2. Set executable permissions                                \u2502\n\u2502  3. Delegate to DatabaseManager                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  core/manager/database.go                     \u2502\n\u2502  1. Create Command record                                     \u2502\n\u2502  2. Store in Storm/BoltDB                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      ~/.cmdr/cmdr.db                          \u2502\n\u2502  Command: {name: \"kubectl\", version: \"1.28.0\", ...}           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/data-flow/#command-activation-flow","title":"Command Activation Flow","text":"<p>When a user runs <code>cmdr command use -n kubectl -v 1.28.0</code>:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    User      \u2502\n\u2502  (CLI input) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     cmd/command/use.go                        \u2502\n\u2502  1. Parse flags (name, version)                               \u2502\n\u2502  2. Query database for command                                \u2502\n\u2502  3. Activate the command version                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  core/manager/command.go                      \u2502\n\u2502  1. Deactivate previous version (if any)                      \u2502\n\u2502  2. Update database: set activated=true                       \u2502\n\u2502  3. Create/update shim in shims directory                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    core/strategy/                             \u2502\n\u2502  Strategy pattern for shim creation:                          \u2502\n\u2502  - DirectStrategy: Symlink to binary                          \u2502\n\u2502  - ProxyStrategy: Script that execs binary                    \u2502\n\u2502  - ChainStrategy: Multiple strategies in sequence             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 ~/.cmdr/shims/kubectl                         \u2502\n\u2502  (Shim script or symlink pointing to active version)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/data-flow/#command-execution-flow","title":"Command Execution Flow","text":"<p>When a user runs a managed command (e.g., <code>kubectl get pods</code>):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    User      \u2502\n\u2502  $ kubectl   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2502 (PATH includes ~/.cmdr/shims)\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              ~/.cmdr/shims/kubectl                            \u2502\n\u2502  (Shim created by CMDR)                                       \u2502\n\u2502  Redirects to actual binary location                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    ~/.cmdr/bin/kubectl-1.28.0                                 \u2502\n\u2502    (Actual binary for the activated version)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Command Output                            \u2502\n\u2502    (Normal command execution)                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/data-flow/#initialization-flow","title":"Initialization Flow","text":"<p>When <code>cmdr init</code> is run:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    User      \u2502\n\u2502  cmdr init   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      cmd/init.go                              \u2502\n\u2502  1. Iterate through registered initializers                   \u2502\n\u2502  2. Call Init(isUpgrade) on each                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u25bc                   \u25bc                   \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Filesystem   \u2502   \u2502    Profile    \u2502   \u2502   Command     \u2502\n\u2502  Initializer  \u2502   \u2502  Initializer  \u2502   \u2502  Initializer  \u2502\n\u2502               \u2502   \u2502               \u2502   \u2502               \u2502\n\u2502 Creates dirs: \u2502   \u2502 Creates shell \u2502   \u2502 Registers     \u2502\n\u2502 - bin/        \u2502   \u2502 profile for   \u2502   \u2502 cmdr as a     \u2502\n\u2502 - shims/      \u2502   \u2502 PATH setup    \u2502   \u2502 managed cmd   \u2502\n\u2502 - profile/    \u2502   \u2502               \u2502   \u2502               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/data-flow/#database-schema","title":"Database Schema","text":"<p>Commands are stored in BoltDB via Storm ORM:</p> <pre><code>type CommandModel struct {\n    ID        int    `storm:\"id,increment\"`\n    Name      string `storm:\"index\"`\n    Version   string\n    Location  string\n    Activated bool   `storm:\"index\"`\n}\n</code></pre> <p>The database file is located at <code>~/.cmdr/cmdr.db</code> by default.</p>"},{"location":"architecture/data-flow/#configuration-flow","title":"Configuration Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Environment Vars   \u2502\n\u2502  (CMDR_*)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Config File        \u2502\u25c4\u2500\u2500\u2500\u2500 ~/.cmdr/config.yaml\n\u2502  (Viper)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  CLI Flags          \u2502\u25c4\u2500\u2500\u2500\u2500 --config, etc.\n\u2502  (Cobra)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Final Config       \u2502\n\u2502  (merged values)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Priority (highest to lowest): 1. CLI flags 2. Environment variables 3. Config file 4. Default values</p>"},{"location":"architecture/design-patterns/","title":"Design Patterns","text":"<p>This document describes the key design patterns used in CMDR.</p>"},{"location":"architecture/design-patterns/#factory-pattern","title":"Factory Pattern","text":"<p>CMDR extensively uses the factory pattern for creating implementations of interfaces. This allows for:</p> <ul> <li>Loose coupling between interface consumers and implementations</li> <li>Easy testing with mock implementations</li> <li>Runtime selection of implementations</li> </ul>"},{"location":"architecture/design-patterns/#implementation","title":"Implementation","text":"<p>Each interface has a corresponding factory registry:</p> <pre><code>// core/command.go\ntype factoryCommandManager func(cfg Configuration) (CommandManager, error)\n\nvar factoriesCommandManager map[CommandProvider]factoryCommandManager\n\nfunc RegisterCommandManagerFactory(key CommandProvider, fn factoryCommandManager) {\n    factoriesCommandManager[key] = fn\n}\n\nfunc NewCommandManager(key CommandProvider, cfg Configuration) (CommandManager, error) {\n    fn, ok := factoriesCommandManager[key]\n    if !ok {\n        return nil, ErrCommandManagerFactoryeNotFound\n    }\n    return fn(cfg)\n}\n</code></pre>"},{"location":"architecture/design-patterns/#registration","title":"Registration","text":"<p>Implementations register themselves in <code>init()</code> functions<sup>1</sup>:</p> <pre><code>// core/manager/binary.go\nfunc init() {\n    core.RegisterCommandManagerFactory(core.CommandProviderBinary, NewBinaryManager)\n}\n</code></pre>"},{"location":"architecture/design-patterns/#usage-examples","title":"Usage Examples","text":"Interface Provider Key Implementation <code>CommandManager</code> <code>CommandProviderDatabase</code> <code>core/manager/database.go</code> <code>CommandManager</code> <code>CommandProviderBinary</code> <code>core/manager/binary.go</code> <code>CommandManager</code> <code>CommandProviderDownload</code> <code>core/manager/download.go</code> <code>Initializer</code> <code>\"filesystem\"</code> <code>core/initializer/filesystem.go</code> <code>Initializer</code> <code>\"profile\"</code> <code>core/initializer/profile.go</code>"},{"location":"architecture/design-patterns/#strategy-pattern","title":"Strategy Pattern","text":"<p>CMDR uses the strategy pattern for shim creation, allowing different approaches to linking commands<sup>2</sup>:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Strategy Interface                     \u2502\n\u2502  type Strategy interface {                              \u2502\n\u2502      Execute(ctx context.Context, cmd Command) error    \u2502\n\u2502  }                                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u25bc                   \u25bc                   \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Direct     \u2502   \u2502     Proxy     \u2502   \u2502    Rewrite    \u2502\n\u2502   Strategy    \u2502   \u2502   Strategy    \u2502   \u2502   Strategy    \u2502\n\u2502               \u2502   \u2502               \u2502   \u2502               \u2502\n\u2502 Creates       \u2502   \u2502 Creates shell \u2502   \u2502 Rewrites URLs \u2502\n\u2502 symlinks      \u2502   \u2502 script proxy  \u2502   \u2502 for download  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/design-patterns/#chain-of-responsibility","title":"Chain of Responsibility","text":"<p>The <code>ChainStrategy</code> combines multiple strategies<sup>3</sup>:</p> <pre><code>// core/strategy/chain.go\ntype ChainStrategy struct {\n    strategies []Strategy\n}\n\nfunc (s *ChainStrategy) Execute(ctx context.Context, cmd Command) error {\n    for _, strategy := range s.strategies {\n        if err := strategy.Execute(ctx, cmd); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n</code></pre>"},{"location":"architecture/design-patterns/#observer-pattern-event-bus","title":"Observer Pattern (Event Bus)","text":"<p>CMDR uses an event bus for decoupled communication between components<sup>4</sup>:</p> <pre><code>// core/bus.go\nvar bus = EventBus.New()\n\nfunc PublishEvent(event string) {\n    bus.Publish(event)\n}\n\nfunc SubscribeEvent(event string, handler func()) {\n    bus.Subscribe(event, handler)\n}\n</code></pre>"},{"location":"architecture/design-patterns/#usage","title":"Usage","text":"<pre><code>// Subscribe to exit event for cleanup\ncore.SubscribeEvent(core.EventExit, func() {\n    // Cleanup resources\n})\n\n// Publish event when application exits\ndefer core.PublishEvent(core.EventExit)\n</code></pre>"},{"location":"architecture/design-patterns/#decorator-pattern-manager-chain","title":"Decorator Pattern (Manager Chain)","text":"<p>Command managers can wrap each other to add functionality:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  DownloadManager                         \u2502\n\u2502  - Downloads file from URL                              \u2502\n\u2502  - Delegates to BinaryManager                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   BinaryManager                          \u2502\n\u2502  - Copies binary to bin directory                       \u2502\n\u2502  - Sets permissions                                     \u2502\n\u2502  - Delegates to DatabaseManager                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  DatabaseManager                         \u2502\n\u2502  - Persists command record                              \u2502\n\u2502  - Core CRUD operations                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Each layer adds specific functionality while delegating core operations to the next layer.</p>"},{"location":"architecture/design-patterns/#dependency-injection","title":"Dependency Injection","text":"<p>Configuration is injected through function parameters rather than global state:</p> <pre><code>// Good: Configuration passed as parameter\nfunc NewCommandManager(key CommandProvider, cfg Configuration) (CommandManager, error) {\n    fn := factoriesCommandManager[key]\n    return fn(cfg)  // cfg passed to factory\n}\n\n// Factory receives configuration\nfunc NewDatabaseManager(cfg Configuration) (CommandManager, error) {\n    dbPath := cfg.GetString(core.CfgKeyCmdrDatabasePath)\n    // ...\n}\n</code></pre> <p>This pattern makes components:</p> <ul> <li>Testable - Configuration can be mocked</li> <li>Flexible - Different configurations for different contexts</li> <li>Explicit - Dependencies are clear from function signatures</li> </ul>"},{"location":"architecture/design-patterns/#interface-segregation","title":"Interface Segregation","text":"<p>CMDR defines focused interfaces<sup>5</sup>:</p> <pre><code>// Command - Read-only view of a command\ntype Command interface {\n    GetName() string\n    GetVersion() string\n    GetActivated() bool\n    GetLocation() string\n}\n\n// CommandQuery - Query builder for commands\ntype CommandQuery interface {\n    WithName(name string) CommandQuery\n    WithVersion(version string) CommandQuery\n    WithActivated(activated bool) CommandQuery\n    All() ([]Command, error)\n    One() (Command, error)\n    Count() (int, error)\n}\n\n// CommandManager - Full management operations\ntype CommandManager interface {\n    Close() error\n    Provider() CommandProvider\n    Query() (CommandQuery, error)\n    Define(name, version, location string) (Command, error)\n    Undefine(name, version string) error\n    Activate(name, version string) error\n    Deactivate(name string) error\n}\n</code></pre> <p>This separation allows consumers to depend only on the interface they need.</p> <ol> <li> <p>Factory registration via init in <code>core/manager/</code> \u21a9</p> </li> <li> <p>Strategy implementations in <code>core/strategy/</code> \u21a9</p> </li> <li> <p>Chain strategy in <code>core/strategy/chain.go</code> \u21a9</p> </li> <li> <p>Event bus in <code>core/bus.go</code> \u21a9</p> </li> <li> <p>Interface definitions in <code>core/command.go</code> L18-L47\u00a0\u21a9</p> </li> </ol>"},{"location":"architecture/overview/","title":"Architecture Overview","text":"<p>This document provides a high-level overview of CMDR's architecture and design principles.</p>"},{"location":"architecture/overview/#system-overview","title":"System Overview","text":"<p>CMDR is a command-line tool built in Go that manages multiple versions of CLI commands. It uses a layered architecture with clear separation between:</p> <ol> <li>CLI Layer (<code>cmd/</code>) - User-facing commands built with Cobra</li> <li>Core Layer (<code>core/</code>) - Business logic, interfaces, and abstractions</li> <li>Storage Layer - BoltDB-based persistence via Storm ORM</li> </ol> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      CLI Layer (cmd/)                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  init   \u2502 \u2502 command \u2502 \u2502 config  \u2502 \u2502 upgrade \u2502 \u2502 doctor \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502          \u2502         \u2502         \u2502          \u2502\n        \u25bc          \u25bc         \u25bc         \u25bc          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Core Layer (core/)                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 CommandManager\u2502  \u2502 Initializer \u2502  \u2502    Strategies    \u2502   \u2502\n\u2502  \u2502   Interface   \u2502  \u2502  Interface  \u2502  \u2502 (shim creation)  \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502          \u2502                 \u2502                   \u2502             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502   Managers    \u2502  \u2502 Initializers\u2502  \u2502    Fetchers      \u2502   \u2502\n\u2502  \u2502 (binary,db,..)\u2502  \u2502(profile,fs) \u2502  \u2502  (go-getter,go)  \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502                    \u2502\n        \u25bc                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Storage Layer                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502   Storm/BoltDB   \u2502     \u2502     Filesystem (shims,      \u2502   \u2502\n\u2502  \u2502   (cmdr.db)      \u2502     \u2502      binaries, profile)     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/overview/#key-components","title":"Key Components","text":""},{"location":"architecture/overview/#entry-point","title":"Entry Point","text":"<p>The application starts in <code>main.go</code>, which:</p> <ol> <li>Sets up panic recovery with custom exit codes<sup>1</sup></li> <li>Publishes an exit event for cleanup</li> <li>Delegates to the CLI layer</li> </ol> <pre><code>// main.go L14-L33\nfunc main() {\n    defer func() {\n        recovered := recover()\n        // Handle ExitError for clean exit codes\n    }()\n    defer core.PublishEvent(core.EventExit)\n    ctx := context.Background()\n    cmd.ExecuteContext(ctx)\n}\n</code></pre>"},{"location":"architecture/overview/#cli-layer-cmd","title":"CLI Layer (<code>cmd/</code>)","text":"<p>The CLI is built with Cobra and organized into subcommands:</p> Command Description Source <code>cmdr init</code> Initialize CMDR environment <code>cmd/init.go</code> <code>cmdr command</code> Manage command versions <code>cmd/command/</code> <code>cmdr config</code> Manage configuration <code>cmd/config/</code> <code>cmdr upgrade</code> Upgrade CMDR itself <code>cmd/upgrade.go</code> <code>cmdr doctor</code> Diagnose issues <code>cmd/doctor.go</code> <code>cmdr version</code> Show version info <code>cmd/version.go</code>"},{"location":"architecture/overview/#core-layer-core","title":"Core Layer (<code>core/</code>)","text":"<p>The core layer defines interfaces and provides implementations:</p>"},{"location":"architecture/overview/#interfaces","title":"Interfaces","text":"<ul> <li><code>CommandManager</code> - CRUD operations for commands<sup>2</sup></li> <li><code>Initializer</code> - System initialization tasks<sup>3</sup></li> <li><code>CmdrSearcher</code> - Finding CMDR releases<sup>4</sup></li> <li><code>Database</code> - Data persistence abstraction<sup>5</sup></li> </ul>"},{"location":"architecture/overview/#implementations","title":"Implementations","text":"<p>Located in subdirectories:</p> <ul> <li><code>core/manager/</code> - Command manager implementations (binary, database, download, doctor)</li> <li><code>core/initializer/</code> - Initialization implementations (filesystem, profile, command)</li> <li><code>core/fetcher/</code> - File download implementations (go-getter, go)</li> <li><code>core/strategy/</code> - Shim creation strategies (direct, proxy, chain, rewrite)</li> </ul>"},{"location":"architecture/overview/#configuration","title":"Configuration","text":"<p>Configuration is managed by Viper with support for:</p> <ul> <li>YAML configuration files</li> <li>Environment variables (prefixed with <code>CMDR_</code>)</li> <li>Command-line flags</li> </ul> <p>Configuration initialization happens in <code>cmd/root.go</code>:</p> <ol> <li><code>preInitConfig()</code> - Set defaults and env binding<sup>6</sup></li> <li><code>initConfig()</code> - Load config file<sup>7</sup></li> <li><code>postInitConfig()</code> - Resolve relative paths<sup>8</sup></li> </ol>"},{"location":"architecture/overview/#factory-pattern","title":"Factory Pattern","text":"<p>CMDR uses the factory pattern extensively for extensibility:</p> <pre><code>// Example from core/command.go\nvar factoriesCommandManager map[CommandProvider]func(cfg Configuration) (CommandManager, error)\n\nfunc RegisterCommandManagerFactory(key CommandProvider, fn func(...) (CommandManager, error)) {\n    factoriesCommandManager[key] = fn\n}\n\nfunc NewCommandManager(key CommandProvider, cfg Configuration) (CommandManager, error) {\n    fn, ok := factoriesCommandManager[key]\n    if !ok {\n        return nil, ErrCommandManagerFactoryeNotFound\n    }\n    return fn(cfg)\n}\n</code></pre> <p>This pattern allows:</p> <ul> <li>Decoupled implementation registration</li> <li>Easy testing with mock implementations</li> <li>Runtime provider selection</li> </ul>"},{"location":"architecture/overview/#event-system","title":"Event System","text":"<p>CMDR uses an event bus for decoupled communication:</p> <pre><code>// core/bus.go\nfunc PublishEvent(event string)\nfunc SubscribeEvent(event string, handler func())\n</code></pre> <p>Events like <code>EventExit</code> allow components to clean up resources without tight coupling.</p> <ol> <li> <p>Exit handling in <code>main.go</code> L15-L28\u00a0\u21a9</p> </li> <li> <p>CommandManager interface in <code>core/command.go</code> L36-L47\u00a0\u21a9</p> </li> <li> <p>Initializer interface in <code>core/initializer.go</code> L5-L7\u00a0\u21a9</p> </li> <li> <p>CmdrSearcher interface in <code>core/cmdr.go</code> L18-L20\u00a0\u21a9</p> </li> <li> <p>Database interface in <code>core/database.go</code> \u21a9</p> </li> <li> <p>Pre-initialization in <code>cmd/root.go</code> L67-L89\u00a0\u21a9</p> </li> <li> <p>Config loading in <code>cmd/root.go</code> L92-L103\u00a0\u21a9</p> </li> <li> <p>Path resolution in <code>cmd/root.go</code> L105-L128\u00a0\u21a9</p> </li> </ol>"},{"location":"components/cli-commands/","title":"CLI Commands","text":"<p>This document details all CLI commands available in CMDR.</p>"},{"location":"components/cli-commands/#root-command","title":"Root Command","text":"<pre><code>cmdr [flags] [command]\n</code></pre>"},{"location":"components/cli-commands/#global-flags","title":"Global Flags","text":"Flag Short Description <code>--config</code> <code>-c</code> Path to config file (default: <code>~/.cmdr/config.yaml</code>) <code>--help</code> <code>-h</code> Help for cmdr"},{"location":"components/cli-commands/#command-management","title":"Command Management","text":""},{"location":"components/cli-commands/#cmdr-command-install","title":"<code>cmdr command install</code>","text":"<p>Install a new command version into CMDR.</p> <pre><code>cmdr command install -n &lt;name&gt; -v &lt;version&gt; -l &lt;location&gt; [-a]\n</code></pre> <p>Flags:</p> Flag Short Required Description <code>--name</code> <code>-n</code> Yes Command name <code>--version</code> <code>-v</code> Yes Version string <code>--location</code> <code>-l</code> Yes URL or file path to the binary <code>--activate</code> <code>-a</code> No Activate immediately after install <p>Source: <code>cmd/command/install.go</code><sup>1</sup></p> <p>Example:</p> <pre><code># Install kubectl 1.28.0 from URL\ncmdr command install -n kubectl -v 1.28.0 -l https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl\n\n# Install and activate immediately\ncmdr command install -n kubectl -v 1.28.0 -l /path/to/kubectl -a\n</code></pre>"},{"location":"components/cli-commands/#cmdr-command-use","title":"<code>cmdr command use</code>","text":"<p>Activate a specific version of a command.</p> <pre><code>cmdr command use -n &lt;name&gt; -v &lt;version&gt;\n</code></pre> <p>Flags:</p> Flag Short Required Description <code>--name</code> <code>-n</code> Yes Command name <code>--version</code> <code>-v</code> Yes Version to activate <p>Source: <code>cmd/command/use.go</code><sup>2</sup></p> <p>Example:</p> <pre><code>cmdr command use -n kubectl -v 1.28.0\n</code></pre>"},{"location":"components/cli-commands/#cmdr-command-list","title":"<code>cmdr command list</code>","text":"<p>List installed command versions.</p> <pre><code>cmdr command list [-n &lt;name&gt;] [-v &lt;version&gt;] [-a]\n</code></pre> <p>Flags:</p> Flag Short Description <code>--name</code> <code>-n</code> Filter by command name <code>--version</code> <code>-v</code> Filter by version <code>--activate</code> <code>-a</code> Show only activated commands <p>Source: <code>cmd/command/list.go</code></p> <p>Example:</p> <pre><code># List all commands\ncmdr command list\n\n# List all versions of kubectl\ncmdr command list -n kubectl\n\n# List only activated commands\ncmdr command list -a\n</code></pre>"},{"location":"components/cli-commands/#cmdr-command-remove","title":"<code>cmdr command remove</code>","text":"<p>Remove a command version.</p> <pre><code>cmdr command remove -n &lt;name&gt; -v &lt;version&gt;\n</code></pre> <p>Flags:</p> Flag Short Required Description <code>--name</code> <code>-n</code> Yes Command name <code>--version</code> <code>-v</code> Yes Version to remove <p>Source: <code>cmd/command/remove.go</code></p>"},{"location":"components/cli-commands/#cmdr-command-unset","title":"<code>cmdr command unset</code>","text":"<p>Deactivate a command (remove from shims).</p> <pre><code>cmdr command unset -n &lt;name&gt;\n</code></pre> <p>Source: <code>cmd/command/unset.go</code></p>"},{"location":"components/cli-commands/#cmdr-command-define","title":"<code>cmdr command define</code>","text":"<p>Define a command without downloading (for local binaries).</p> <pre><code>cmdr command define -n &lt;name&gt; -v &lt;version&gt; -l &lt;path&gt; [-a]\n</code></pre> <p>Source: <code>cmd/command/define.go</code></p>"},{"location":"components/cli-commands/#configuration-management","title":"Configuration Management","text":""},{"location":"components/cli-commands/#cmdr-config-list","title":"<code>cmdr config list</code>","text":"<p>List all configuration values.</p> <pre><code>cmdr config list\n</code></pre> <p>Source: <code>cmd/config/list.go</code></p>"},{"location":"components/cli-commands/#cmdr-config-get","title":"<code>cmdr config get</code>","text":"<p>Get a specific configuration value.</p> <pre><code>cmdr config get -k &lt;key&gt;\n</code></pre> <p>Source: <code>cmd/config/get.go</code></p>"},{"location":"components/cli-commands/#cmdr-config-set","title":"<code>cmdr config set</code>","text":"<p>Set a configuration value.</p> <pre><code>cmdr config set -k &lt;key&gt; -v &lt;value&gt;\n</code></pre> <p>Source: <code>cmd/config/set.go</code></p> <p>Example:</p> <pre><code># Set log level\ncmdr config set -k log.level -v debug\n\n# Set URL replacement for proxy\ncmdr config set -k download.replace -v '{\"match\": \"...\", \"template\": \"...\"}'\n</code></pre>"},{"location":"components/cli-commands/#system-commands","title":"System Commands","text":""},{"location":"components/cli-commands/#cmdr-init","title":"<code>cmdr init</code>","text":"<p>Initialize CMDR environment.</p> <pre><code>cmdr init\n</code></pre> <p>This command: 1. Creates directory structure (<code>bin/</code>, <code>shims/</code>, <code>profile/</code>) 2. Generates shell profile scripts 3. Registers CMDR itself as a managed command</p> <p>Source: <code>cmd/init.go</code></p>"},{"location":"components/cli-commands/#cmdr-upgrade","title":"<code>cmdr upgrade</code>","text":"<p>Upgrade CMDR to the latest version.</p> <pre><code>cmdr upgrade [-r &lt;release&gt;] [-a &lt;asset&gt;]\n</code></pre> <p>Flags:</p> Flag Short Description <code>--release</code> <code>-r</code> Specific release name (default: latest) <code>--asset</code> <code>-a</code> Specific asset name <p>Source: <code>cmd/upgrade.go</code></p>"},{"location":"components/cli-commands/#cmdr-doctor","title":"<code>cmdr doctor</code>","text":"<p>Diagnose CMDR installation issues.</p> <pre><code>cmdr doctor\n</code></pre> <p>Checks for: - Directory structure integrity - Database accessibility - Shell profile configuration - PATH configuration</p> <p>Source: <code>cmd/doctor.go</code></p>"},{"location":"components/cli-commands/#cmdr-version","title":"<code>cmdr version</code>","text":"<p>Display CMDR version information.</p> <pre><code>cmdr version\n</code></pre> <p>Source: <code>cmd/version.go</code></p>"},{"location":"components/cli-commands/#command-structure","title":"Command Structure","text":"<pre><code>cmdr\n\u251c\u2500\u2500 command\n\u2502   \u251c\u2500\u2500 define    # Define command from local path\n\u2502   \u251c\u2500\u2500 install   # Install command from URL/path\n\u2502   \u251c\u2500\u2500 list      # List installed commands\n\u2502   \u251c\u2500\u2500 remove    # Remove a command version\n\u2502   \u251c\u2500\u2500 unset     # Deactivate a command\n\u2502   \u2514\u2500\u2500 use       # Activate a command version\n\u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 get       # Get config value\n\u2502   \u251c\u2500\u2500 list      # List all config\n\u2502   \u2514\u2500\u2500 set       # Set config value\n\u251c\u2500\u2500 doctor        # Diagnose issues\n\u251c\u2500\u2500 init          # Initialize CMDR\n\u251c\u2500\u2500 upgrade       # Upgrade CMDR\n\u2514\u2500\u2500 version       # Show version\n</code></pre> <ol> <li> <p>Install command implementation in <code>cmd/command/install.go</code> L12-L37\u00a0\u21a9</p> </li> <li> <p>Use command implementation in <code>cmd/command/use.go</code> L12-L32\u00a0\u21a9</p> </li> </ol>"},{"location":"components/command-manager/","title":"Command Manager","text":"<p>The Command Manager is the core abstraction for managing command versions in CMDR. It provides a layered architecture with different providers for different concerns.</p>"},{"location":"components/command-manager/#overview","title":"Overview","text":"<p>Command managers follow a chain-of-responsibility pattern where each manager wraps another, adding specific functionality:</p> <pre><code>DownloadManager \u2192 BinaryManager \u2192 DatabaseManager\n</code></pre> <p>Each layer delegates to the next while adding its own behavior.</p>"},{"location":"components/command-manager/#commandmanager-interface","title":"CommandManager Interface","text":"<p>The core interface defines operations for managing commands<sup>1</sup>:</p> <pre><code>type CommandManager interface {\n    Close() error\n    Provider() CommandProvider\n    Query() (CommandQuery, error)\n    Define(name, version, location string) (Command, error)\n    Undefine(name, version string) error\n    Activate(name, version string) error\n    Deactivate(name string) error\n}\n</code></pre>"},{"location":"components/command-manager/#manager-implementations","title":"Manager Implementations","text":""},{"location":"components/command-manager/#databasemanager","title":"DatabaseManager","text":"<p>Source: <code>core/manager/database.go</code></p> <p>Provider: <code>CommandProviderDatabase</code></p> <p>Responsibilities:</p> <ul> <li>Persist command metadata in BoltDB via Storm ORM</li> <li>Query commands by name, version, location, activation status</li> <li>Wrap BinaryManager for actual file operations</li> </ul> <p>Key Operations:</p> <pre><code>// Define a command - saves to database and delegates to BinaryManager\nfunc (m *DatabaseManager) Define(name, version, location string) (Command, error)\n\n// Query commands with flexible filtering\nfunc (m *DatabaseManager) Query() (CommandQuery, error)\n\n// Activate - deactivates others, updates DB, delegates to BinaryManager\nfunc (m *DatabaseManager) Activate(name, version string) error\n</code></pre> <p>Implementation Details:</p> <ul> <li>Uses version matching to support both raw and semantic versions<sup>2</sup></li> <li>Enforces single activation per command name</li> <li>Prevents deletion of activated commands<sup>3</sup></li> </ul>"},{"location":"components/command-manager/#binarymanager","title":"BinaryManager","text":"<p>Source: <code>core/manager/binary.go</code></p> <p>Provider: <code>CommandProviderBinary</code></p> <p>Responsibilities:</p> <ul> <li>Manage physical binary files in <code>~/.cmdr/shims/&lt;command&gt;/</code></li> <li>Create symlinks or copies of binaries</li> <li>Handle version normalization (e.g., <code>1.0</code> \u2192 <code>1.0.0</code>)</li> <li>Create activation symlinks in <code>bin/</code> directory</li> </ul> <p>Directory Structure:</p> <pre><code>~/.cmdr/\n\u251c\u2500\u2500 bin/\n\u2502   \u2514\u2500\u2500 kubectl -&gt; ../shims/kubectl/kubectl_1.28.0\n\u2514\u2500\u2500 shims/\n    \u2514\u2500\u2500 kubectl/\n        \u251c\u2500\u2500 kubectl_1.28.0\n        \u2514\u2500\u2500 kubectl_1.29.0\n</code></pre> <p>Key Operations:</p> <pre><code>// Define - copy or link binary to shims directory\nfunc (m *BinaryManager) Define(name, version, location string) (Command, error)\n\n// Activate - create symlink in bin/ directory\nfunc (m *BinaryManager) Activate(name, version string) error\n\n// Deactivate - remove symlink from bin/ directory\nfunc (m *BinaryManager) Deactivate(name string) error\n</code></pre> <p>Link Modes:</p> <p>The manager supports two link modes<sup>4</sup>:</p> Mode Behavior Use Case <code>copy</code> (default) Copy binary to shims directory Maximum compatibility <code>link</code> Create symlink to original location Save disk space <p>Set via configuration:</p> <pre><code>cmdr config set -k core.link_mode -v link\n</code></pre>"},{"location":"components/command-manager/#downloadmanager","title":"DownloadManager","text":"<p>Source: <code>core/manager/download.go</code></p> <p>Provider: <code>CommandProviderDownload</code></p> <p>Responsibilities:</p> <ul> <li>Download binaries from URLs</li> <li>Validate downloaded files</li> <li>Apply URL rewrite rules</li> <li>Delegate to BinaryManager for storage</li> </ul> <p>Key Operations:</p> <pre><code>// Define - download from URL, then delegate to BinaryManager\nfunc (m *DownloadManager) Define(name, version, location string) (Command, error)\n</code></pre> <p>URL Rewriting:</p> <p>Supports URL replacement patterns for proxying downloads:</p> <pre><code>// Configuration example\n{\n    \"match\": \"^https://raw.githubusercontent.com/.*$\",\n    \"template\": \"https://ghproxy.com/{{ .input | urlquery }}\"\n}\n</code></pre>"},{"location":"components/command-manager/#doctormanager","title":"DoctorManager","text":"<p>Source: <code>core/manager/doctor.go</code></p> <p>Provider: <code>CommandProviderDoctor</code></p> <p>Responsibilities:</p> <ul> <li>Diagnose installation issues</li> <li>Verify directory structure</li> <li>Check database integrity</li> <li>Validate PATH configuration</li> </ul>"},{"location":"components/command-manager/#command-interface","title":"Command Interface","text":"<p>Commands are read-only views of managed commands<sup>5</sup>:</p> <pre><code>type Command interface {\n    GetName() string\n    GetVersion() string\n    GetActivated() bool\n    GetLocation() string\n}\n</code></pre>"},{"location":"components/command-manager/#commandquery-interface","title":"CommandQuery Interface","text":"<p>Provides fluent API for filtering commands<sup>6</sup>:</p> <pre><code>type CommandQuery interface {\n    WithName(name string) CommandQuery\n    WithVersion(version string) CommandQuery\n    WithActivated(activated bool) CommandQuery\n    WithLocation(location string) CommandQuery\n\n    All() ([]Command, error)\n    One() (Command, error)\n    Count() (int, error)\n}\n</code></pre> <p>Example Usage:</p> <pre><code>// Find activated kubectl command\nquery, _ := manager.Query()\ncmd, _ := query.WithName(\"kubectl\").WithActivated(true).One()\n\n// List all versions of kubectl\nquery, _ := manager.Query()\ncommands, _ := query.WithName(\"kubectl\").All()\n</code></pre>"},{"location":"components/command-manager/#factory-registration","title":"Factory Registration","text":"<p>Managers register themselves via the factory pattern<sup>7</sup>:</p> <pre><code>// In init() function\ncore.RegisterCommandManagerFactory(core.CommandProviderDatabase, func(cfg Configuration) (CommandManager, error) {\n    // Create BinaryManager first\n    mgr, _ := core.NewCommandManager(core.CommandProviderBinary, cfg)\n    db, _ := core.GetDatabase()\n    return NewDatabaseManager(db, mgr), nil\n})\n</code></pre>"},{"location":"components/command-manager/#version-handling","title":"Version Handling","text":"<p>CMDR normalizes versions using semantic versioning:</p> <ul> <li>Input: <code>1.0</code>, <code>v1.0.0</code>, <code>1.0.0</code></li> <li>Normalized: <code>1.0.0</code></li> </ul> <p>This ensures consistent storage and lookup across different version formats.</p> <ol> <li> <p>CommandManager interface in <code>core/command.go</code> L36-L47\u00a0\u21a9</p> </li> <li> <p>Version matching in <code>core/manager/database.go</code> L12-L18\u00a0\u21a9</p> </li> <li> <p>Activated command protection in <code>core/manager/database.go</code> L104-L106\u00a0\u21a9</p> </li> <li> <p>Link mode configuration in <code>core/manager/binary.go</code> L415-L425\u00a0\u21a9</p> </li> <li> <p>Command interface in <code>core/command.go</code> L18-L23\u00a0\u21a9</p> </li> <li> <p>CommandQuery interface in <code>core/command.go</code> L25-L34\u00a0\u21a9</p> </li> <li> <p>Factory registration in <code>core/manager/database.go</code> L182-L196\u00a0\u21a9</p> </li> </ol>"},{"location":"components/fetchers/","title":"Fetchers","text":"<p>Fetchers are responsible for downloading files from various sources (URLs, local paths, Git repositories, etc.).</p>"},{"location":"components/fetchers/#fetcher-interface","title":"Fetcher Interface","text":"<p>The core interface is minimal<sup>1</sup>:</p> <pre><code>type Fetcher interface {\n    Fetch(source, destination string) error\n}\n</code></pre>"},{"location":"components/fetchers/#fetcher-implementations","title":"Fetcher Implementations","text":""},{"location":"components/fetchers/#gogetterfetcher","title":"GoGetterFetcher","text":"<p>Source: <code>core/fetcher/go_getter.go</code></p> <p>Uses HashiCorp's go-getter library for flexible URL-based downloads.</p> <p>Supported Sources:</p> Protocol Example Description HTTP/HTTPS <code>https://example.com/file.tar.gz</code> Direct downloads Git <code>git::https://github.com/user/repo.git</code> Clone Git repositories GitHub <code>github.com/user/repo</code> GitHub shortcuts File <code>file:///path/to/file</code> Local files S3 <code>s3::https://s3.amazonaws.com/bucket/key</code> AWS S3 objects <p>Features:</p> <ul> <li>Automatic archive extraction (tar, zip, etc.)</li> <li>Checksum verification</li> <li>Sub-directory selection</li> <li>Git ref/branch/tag selection</li> </ul> <p>Configuration:</p> <p>Uses strategy chain for advanced download capabilities (proxy, rewrite, retry).</p>"},{"location":"components/fetchers/#gofetcher","title":"GoFetcher","text":"<p>Source: <code>core/fetcher/go.go</code></p> <p>Specialized fetcher for Go module downloads.</p> <p>Usage:</p> <pre><code>fetcher := NewGoFetcher()\nerr := fetcher.Fetch(\"golang.org/x/tools/cmd/goimports@latest\", \"/tmp/goimports\")\n</code></pre> <p>Features:</p> <ul> <li>Go module resolution</li> <li>Version/tag specification</li> <li>Binary installation from Go packages</li> </ul>"},{"location":"components/fetchers/#factory-pattern","title":"Factory Pattern","text":"<p>Fetchers don't use a factory pattern in the current implementation. Instead, they're instantiated directly:</p> <pre><code>// In DownloadManager\nfetcher := fetcher.NewGoGetterFetcher(cfg, strategyChain)\n</code></pre>"},{"location":"components/fetchers/#usage-in-downloadmanager","title":"Usage in DownloadManager","text":"<p>The DownloadManager uses fetchers to download commands during installation:</p> <pre><code>// core/manager/download.go\nfunc (m *DownloadManager) Define(name, version, location string) (Command, error) {\n    // 1. Create temp directory\n    tempDir := filepath.Join(os.TempDir(), fmt.Sprintf(\"cmdr-%s-%s\", name, version))\n\n    // 2. Fetch file to temp directory\n    err := m.fetcher.Fetch(location, tempDir)\n\n    // 3. Validate downloaded file\n    // 4. Delegate to BinaryManager for storage\n    return m.manager.Define(name, version, realLocation)\n}\n</code></pre>"},{"location":"components/fetchers/#archive-handling","title":"Archive Handling","text":"<p>go-getter automatically handles archives:</p> Format Auto-Extract <code>.tar.gz</code> Yes <code>.tgz</code> Yes <code>.tar</code> Yes <code>.zip</code> Yes <code>.tar.bz2</code> Yes <code>.tar.xz</code> Yes <p>Example:</p> <pre><code># Downloads and extracts tar.gz automatically\ncmdr command install kubectl -v 1.28.0 -l https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl.tar.gz\n</code></pre>"},{"location":"components/fetchers/#sub-directory-selection","title":"Sub-Directory Selection","text":"<p>You can select a specific file from an archive:</p> <pre><code># Format: url//subpath\ncmdr command install node -v 18.0.0 -l https://nodejs.org/dist/v18.0.0/node-v18.0.0-linux-x64.tar.gz//node-v18.0.0-linux-x64/bin/node\n</code></pre>"},{"location":"components/fetchers/#git-repository-cloning","title":"Git Repository Cloning","text":"<p>Fetch from Git repositories:</p> <pre><code># Clone repository\ncmdr command install script -v 1.0.0 -l git::https://github.com/user/repo.git\n\n# Specific branch\ncmdr command install script -v 1.0.0 -l git::https://github.com/user/repo.git?ref=main\n\n# Specific tag\ncmdr command install script -v 1.0.0 -l git::https://github.com/user/repo.git?ref=v1.0.0\n\n# Specific commit\ncmdr command install script -v 1.0.0 -l git::https://github.com/user/repo.git?ref=abc123\n\n# Sub-path in repository\ncmdr command install script -v 1.0.0 -l git::https://github.com/user/repo.git//scripts/install.sh\n</code></pre>"},{"location":"components/fetchers/#error-handling","title":"Error Handling","text":"<p>Fetchers propagate errors from underlying libraries. The DownloadManager's strategy chain provides retry logic:</p> <pre><code>Fetch Error \u2192 DownloadManager \u2192 Strategy Chain\n                                 \u251c\u2500 Should Retry? \u2192 Retry\n                                 \u2514\u2500 Should Fallback? \u2192 Next Strategy\n</code></pre>"},{"location":"components/fetchers/#checksum-verification","title":"Checksum Verification","text":"<p>go-getter supports checksum verification:</p> <pre><code># Format: url?checksum=type:value\ncmdr command install kubectl -v 1.28.0 -l \\\n  \"https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl?checksum=sha256:abc123...\"\n</code></pre>"},{"location":"components/fetchers/#custom-fetcher-implementation","title":"Custom Fetcher Implementation","text":"<p>To implement a custom fetcher:</p> <pre><code>type CustomFetcher struct {\n    // Configuration\n}\n\nfunc (f *CustomFetcher) Fetch(source, destination string) error {\n    // 1. Parse source URL\n    // 2. Download file(s)\n    // 3. Validate integrity\n    // 4. Save to destination\n    return nil\n}\n\nfunc NewCustomFetcher() *CustomFetcher {\n    return &amp;CustomFetcher{}\n}\n</code></pre> <p>Then use in DownloadManager:</p> <pre><code>customFetcher := fetcher.NewCustomFetcher()\ndownloadMgr := manager.NewDownloadManager(cfg, binaryMgr, customFetcher)\n</code></pre>"},{"location":"components/fetchers/#testing-fetchers","title":"Testing Fetchers","text":"<p>Fetchers can be tested with mock HTTP servers:</p> <pre><code>func TestGoGetterFetcher(t *testing.T) {\n    // Create test server\n    server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"file content\"))\n    }))\n    defer server.Close()\n\n    // Test fetch\n    fetcher := NewGoGetterFetcher(cfg, strategyChain)\n    err := fetcher.Fetch(server.URL, \"/tmp/test\")\n    // Assert no error, file exists\n}\n</code></pre> <ol> <li> <p>Fetcher interface in <code>core/fetcher.go</code> \u21a9</p> </li> </ol>"},{"location":"components/initializers/","title":"Initializers","text":"<p>Initializers are responsible for setting up the CMDR environment during the <code>cmdr init</code> command. They configure the filesystem, shell profiles, and other necessary components.</p>"},{"location":"components/initializers/#initializer-interface","title":"Initializer Interface","text":"<p>The core interface is simple<sup>1</sup>:</p> <pre><code>type Initializer interface {\n    Init(isUpgrade bool) error\n}\n</code></pre> <p>The <code>isUpgrade</code> parameter indicates whether this is a fresh installation or an upgrade of an existing installation.</p>"},{"location":"components/initializers/#factory-registration","title":"Factory Registration","text":"<p>Initializers register themselves via factory pattern<sup>2</sup>:</p> <pre><code>core.RegisterInitializerFactory(\"filesystem\", func(cfg Configuration) (Initializer, error) {\n    return NewFilesystemInitializer(cfg), nil\n})\n</code></pre>"},{"location":"components/initializers/#initializer-implementations","title":"Initializer Implementations","text":""},{"location":"components/initializers/#filesystem-initializers","title":"Filesystem Initializers","text":"<p>Source: <code>core/initializer/filesystem.go</code></p>"},{"location":"components/initializers/#fsbackup","title":"FSBackup","text":"<p>Backs up existing profile directory before modifications<sup>3</sup>:</p> <pre><code>type FSBackup struct {\n    path   string  // Directory to backup\n    target string  // Backup location\n}\n</code></pre> <p>Usage: Registered as <code>\"profile-dir-backup\"</code></p>"},{"location":"components/initializers/#embedfsexporter","title":"EmbedFSExporter","text":"<p>Exports embedded filesystem to disk<sup>4</sup>:</p> <pre><code>type EmbedFSExporter struct {\n    filesystem fs.FS       // Embedded filesystem\n    srcPath    string      // Source path in embed\n    dstPath    string      // Destination path on disk\n    fileMode   os.FileMode // File permissions\n}\n</code></pre> <p>Usage: Registered as <code>\"profile-dir-export\"</code> - exports shell profile scripts from embedded assets.</p>"},{"location":"components/initializers/#dirrender","title":"DirRender","text":"<p>Renders Go templates in a directory<sup>5</sup>:</p> <pre><code>type DirRender struct {\n    data    interface{} // Template data\n    srcPath string      // Directory to render\n    ext     string      // Template extension (e.g., \".gotmpl\")\n}\n</code></pre> <p>Usage: Registered as <code>\"profile-dir-render\"</code> - renders profile templates with configuration.</p>"},{"location":"components/initializers/#profile-initializer","title":"Profile Initializer","text":"<p>Source: <code>core/initializer/profile.go</code></p>"},{"location":"components/initializers/#profileinjector","title":"ProfileInjector","text":"<p>Injects CMDR initialization script into shell profile<sup>6</sup>:</p> <pre><code>type ProfileInjector struct {\n    scriptPath  string // Path to cmdr_initializer.sh\n    profilePath string // Path to shell profile (~/.bashrc, ~/.zshrc, etc.)\n}\n</code></pre> <p>Key Operations:</p> <ol> <li>Detect Shell Profile<sup>7</sup>:</li> <li>Bash \u2192 <code>~/.bashrc</code></li> <li>Zsh \u2192 <code>~/.zshrc</code></li> <li>Fish \u2192 <code>~/.config/fish/config.fish</code></li> <li> <p>Ash/Sh \u2192 <code>~/.profile</code></p> </li> <li> <p>Generate Profile Statement:    <pre><code>source '/path/to/.cmdr/profile/cmdr_initializer.sh'\n</code></pre></p> </li> <li> <p>Update Profile:</p> </li> <li>Reads existing profile</li> <li>Replaces old CMDR source line (if exists)</li> <li>Adds source line (if not exists)</li> <li>Writes updated profile</li> </ol> <p>Shell Detection: Uses parent process inspection to determine the current shell.</p>"},{"location":"components/initializers/#command-initializer","title":"Command Initializer","text":"<p>Source: <code>core/initializer/command.go</code></p> <p>Registers CMDR itself as a managed command, enabling <code>cmdr upgrade</code>.</p>"},{"location":"components/initializers/#database-initializer","title":"Database Initializer","text":"<p>Source: <code>core/initializer/database.go</code></p> <p>Initializes the BoltDB database schema.</p>"},{"location":"components/initializers/#initialization-flow","title":"Initialization Flow","text":"<p>When <code>cmdr init</code> is run, initializers execute in this order:</p> <pre><code>1. profile-dir-backup\n   \u2514\u2500&gt; Backup existing profile directory\n\n2. binary (BinaryManager.Init)\n   \u2514\u2500&gt; Create bin/ and shims/ directories\n\n3. profile-dir-export\n   \u2514\u2500&gt; Export embedded profile scripts\n\n4. profile-dir-render\n   \u2514\u2500&gt; Render profile templates with config\n\n5. profile-injector\n   \u2514\u2500&gt; Add source line to shell profile\n\n6. database\n   \u2514\u2500&gt; Initialize database schema\n\n7. command\n   \u2514\u2500&gt; Register cmdr as managed command\n</code></pre>"},{"location":"components/initializers/#embedded-assets","title":"Embedded Assets","text":"<p>CMDR embeds shell profile scripts using Go 1.16+ embed:</p> <pre><code>//go:embed embed/*\nvar EmbedFS embed.FS\n</code></pre> <p>The embedded profile directory contains:</p> <pre><code>embed/\n\u2514\u2500\u2500 profile/\n    \u251c\u2500\u2500 cmdr_initializer.sh.gotmpl  # Shell initializer template\n    \u2514\u2500\u2500 ...\n</code></pre> <p>These are extracted to <code>~/.cmdr/profile/</code> and rendered with configuration values.</p>"},{"location":"components/initializers/#template-rendering","title":"Template Rendering","text":"<p>Templates use Go's <code>text/template</code> package with configuration data:</p> <pre><code>// Example template\n// cmdr_initializer.sh.gotmpl\nexport CMDR_ROOT=\"{{.Configuration.GetString \"core.root_dir\"}}\"\nexport PATH=\"{{.Configuration.GetString \"core.bin_dir\"}}:$PATH\"\n</code></pre> <p>Rendered output:</p> <pre><code>export CMDR_ROOT=\"/home/user/.cmdr\"\nexport PATH=\"/home/user/.cmdr/bin:$PATH\"\n</code></pre>"},{"location":"components/initializers/#safety-features","title":"Safety Features","text":"<ol> <li>Backup Before Modify: Profile directory is backed up before changes</li> <li>Idempotent Injection: Multiple <code>cmdr init</code> calls don't duplicate source lines</li> <li>Version Migration: Old format source lines are updated to new format</li> <li>Error Recovery: Failures during init don't leave system in broken state</li> </ol>"},{"location":"components/initializers/#testing-initializers","title":"Testing Initializers","text":"<p>Initializers can be tested independently:</p> <pre><code>// Example test\ncfg := core.NewConfiguration()\ncfg.Set(core.CfgKeyCmdrProfileDir, \"/tmp/test-profile\")\n\ninjector := NewProfileInjector(\"/tmp/test-profile/init.sh\", \"/tmp/.bashrc\")\nerr := injector.Init(false)\n</code></pre> <ol> <li> <p>Initializer interface in <code>core/initializer.go</code> L5-L7\u00a0\u21a9</p> </li> <li> <p>Factory registration pattern in <code>core/initializer.go</code> L18-L20\u00a0\u21a9</p> </li> <li> <p>FSBackup implementation in <code>core/initializer/filesystem.go</code> L21-L61\u00a0\u21a9</p> </li> <li> <p>EmbedFSExporter implementation in <code>core/initializer/filesystem.go</code> L63-L146\u00a0\u21a9</p> </li> <li> <p>DirRender implementation in <code>core/initializer/filesystem.go</code> L148-L264\u00a0\u21a9</p> </li> <li> <p>ProfileInjector implementation in <code>core/initializer/profile.go</code> L20-L118\u00a0\u21a9</p> </li> <li> <p>Shell detection in <code>core/initializer/profile.go</code> L120-L151\u00a0\u21a9</p> </li> </ol>"},{"location":"components/strategies/","title":"Strategies","text":"<p>Strategies implement different approaches for linking commands to the <code>bin/</code> directory. CMDR uses the Strategy pattern to allow flexible command activation methods.</p>"},{"location":"components/strategies/#strategy-interface","title":"Strategy Interface","text":"<p>The core download strategy interface<sup>1</sup>:</p> <pre><code>type DownloadStrategy interface {\n    Name() string\n    Prepare(uri string) (string, error)\n    ShouldRetry(err error) bool\n    ShouldFallback(err error) bool\n    Configure(cfg Configuration) error\n    IsEnabled(uri string) bool\n    SetEnabled(enabled bool)\n}\n</code></pre>"},{"location":"components/strategies/#strategy-implementations","title":"Strategy Implementations","text":""},{"location":"components/strategies/#directstrategy","title":"DirectStrategy","text":"<p>Source: <code>core/strategy/direct.go</code></p> <p>Downloads files directly without modifications.</p> <p>Features:</p> <ul> <li>Retry Logic<sup>2</sup>: Retries on timeout and connection errors</li> <li>Fallback Logic: Falls back to next strategy on network errors</li> <li>Configuration:   <pre><code>download:\n  direct:\n    timeout: 30        # seconds\n    max_retries: 3\n</code></pre></li> </ul> <p>Error Handling:</p> Error Type Action Timeout Retry Connection refused/reset Retry Temporary network error Retry Other network errors Fallback to next strategy"},{"location":"components/strategies/#proxystrategy","title":"ProxyStrategy","text":"<p>Source: <code>core/strategy/proxy.go</code></p> <p>Downloads through HTTP or SOCKS5 proxy.</p> <p>Configuration:</p> <pre><code>download:\n  proxy:\n    enabled: true\n    type: http                           # or \"socks5\"\n    address: http://proxy.example.com:8080\n    timeout: 60\n    max_retries: 5\n</code></pre> <p>Proxy Types:</p> <ul> <li><code>http</code> - HTTP/HTTPS proxy</li> <li><code>socks5</code> - SOCKS5 proxy</li> </ul>"},{"location":"components/strategies/#rewritestrategy","title":"RewriteStrategy","text":"<p>Source: <code>core/strategy/rewrite.go</code></p> <p>Rewrites download URLs using templates (for mirrors, CDNs).</p> <p>Configuration:</p> <pre><code>download:\n  rewrite:\n    rule: \"https://mirror.example.com{{.Path}}\"\n</code></pre> <p>Template Variables:</p> Variable Description Example <code>{{.URI}}</code> Full original URI <code>https://github.com/user/repo/file.tar.gz</code> <code>{{.Scheme}}</code> URI scheme <code>https</code> <code>{{.Host}}</code> URI host <code>github.com</code> <code>{{.Path}}</code> URI path <code>/user/repo/file.tar.gz</code> <code>{{.Query}}</code> URI query <code>?token=abc</code> <code>{{.Fragment}}</code> URI fragment <code>#section</code> <p>Example:</p> <pre><code># Redirect GitHub downloads to mirror\ndownload:\n  rewrite:\n    rule: \"https://ghproxy.com/{{.URI}}\"\n</code></pre> <p>Original: <code>https://github.com/nodejs/node/archive/v18.0.0.tar.gz</code> Rewritten: <code>https://ghproxy.com/https://github.com/nodejs/node/archive/v18.0.0.tar.gz</code></p>"},{"location":"components/strategies/#chainstrategy","title":"ChainStrategy","text":"<p>Source: <code>core/strategy/chain.go</code></p> <p>Combines multiple strategies with retry and fallback logic.</p> <p>Execution Flow:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    ChainStrategy                         \u2502\n\u2502                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Rewrite  \u2502\u2192 \u2502  Proxy   \u2502\u2192 \u2502  Direct  \u2502\u2192 \u2502  ...    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502       \u2502 Retry       \u2502 Retry       \u2502 Retry       \u2502       \u2502\n\u2502       \u2502 \u2193           \u2502 \u2193           \u2502 \u2193           \u2502       \u2502\n\u2502       \u2502 Fallback \u2192  \u2502 Fallback \u2192  \u2502 Fallback \u2192  \u2502       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Logic:</p> <ol> <li>Try first enabled strategy</li> <li>On retriable error: retry up to <code>max_retries</code></li> <li>On fallback error: try next strategy</li> <li>If all strategies fail: return error</li> </ol>"},{"location":"components/strategies/#conditional-strategy-execution","title":"Conditional Strategy Execution","text":"<p>Strategies can be conditionally enabled based on URI patterns:</p> <pre><code>download:\n  proxy:\n    enabled: true\n    condition:\n      schemes: [https]              # Only HTTPS\n      hosts: [github.com]           # Only GitHub\n      patterns: [\"*.github.com\"]    # Glob patterns\n</code></pre> <p>Matching Rules:</p> <ul> <li>Schemes: Match URI scheme (http, https, git, etc.)</li> <li>Hosts: Match exact hostname</li> <li>Patterns: Match hostname with glob patterns</li> </ul> <p>Example:</p> <pre><code># Use proxy only for GitHub\ndownload:\n  proxy:\n    enabled: true\n    address: http://github-proxy:8080\n    condition:\n      hosts: [github.com]\n\n# Rewrite only for GitLab\n  rewrite:\n    rule: \"https://gitlab-mirror.com{{.Path}}\"\n    condition:\n      hosts: [gitlab.com]\n</code></pre> <p>Result: - <code>https://github.com/file</code> \u2192 Uses proxy - <code>https://gitlab.com/file</code> \u2192 Uses rewrite - <code>https://nodejs.org/file</code> \u2192 Uses direct</p>"},{"location":"components/strategies/#strategy-configuration","title":"Strategy Configuration","text":"<p>Complete strategy configuration:</p> <pre><code>download:\n  # Always try direct first\n  direct:\n    timeout: 30\n    max_retries: 3\n    enabled: true\n\n  # Use proxy for GitHub\n  proxy:\n    enabled: true\n    type: http\n    address: http://proxy.example.com:8080\n    timeout: 60\n    max_retries: 5\n    condition:\n      hosts: [github.com]\n\n  # Use mirror for GitLab\n  rewrite:\n    rule: \"https://mirror.com{{.Path}}\"\n    enabled: true\n    condition:\n      hosts: [gitlab.com]\n</code></pre>"},{"location":"components/strategies/#legacy-url-replacement","title":"Legacy URL Replacement","text":"<p>CMDR still supports the legacy <code>download.replace</code> configuration:</p> <pre><code>download:\n  replace:\n    match: \"^https://raw.githubusercontent.com/.*$\"\n    template: \"https://ghproxy.com/{{ .input | urlquery }}\"\n</code></pre> <p>This is internally converted to a RewriteStrategy.</p>"},{"location":"components/strategies/#adding-custom-strategies","title":"Adding Custom Strategies","text":"<p>To add a new strategy:</p> <ol> <li>Implement the interface:</li> </ol> <pre><code>type CustomStrategy struct {\n    config *StrategyConfig\n}\n\nfunc (s *CustomStrategy) Name() string {\n    return \"custom\"\n}\n\nfunc (s *CustomStrategy) Prepare(uri string) (string, error) {\n    // Transform URI as needed\n    return transformedURI, nil\n}\n\nfunc (s *CustomStrategy) ShouldRetry(err error) bool {\n    // Define retry logic\n    return isRetriableError(err)\n}\n\nfunc (s *CustomStrategy) ShouldFallback(err error) bool {\n    // Define fallback logic\n    return isFallbackError(err)\n}\n\nfunc (s *CustomStrategy) Configure(cfg Configuration) error {\n    // Load configuration\n    return nil\n}\n\nfunc (s *CustomStrategy) IsEnabled(uri string) bool {\n    return s.config.Matches(uri)\n}\n</code></pre> <ol> <li>Register in DownloadManager:</li> </ol> <pre><code>customStrategy := NewCustomStrategy()\nchain := NewStrategyChain(\n    NewRewriteStrategy(),\n    NewProxyStrategy(),\n    customStrategy,\n    NewDirectStrategy(),\n)\n</code></pre>"},{"location":"components/strategies/#testing-strategies","title":"Testing Strategies","text":"<p>Strategies can be unit tested:</p> <pre><code>func TestDirectStrategy(t *testing.T) {\n    strategy := NewDirectStrategy()\n    cfg := core.NewConfiguration()\n    cfg.Set(\"download.direct.timeout\", 30)\n\n    err := strategy.Configure(cfg)\n    // Assert no error\n\n    uri, err := strategy.Prepare(\"https://example.com/file\")\n    // Assert URI unchanged\n}\n</code></pre> <ol> <li> <p>Strategy interface in <code>core/strategy/strategy.go</code> \u21a9</p> </li> <li> <p>DirectStrategy retry logic in <code>core/strategy/direct.go</code> L31-L50\u00a0\u21a9</p> </li> </ol>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>CMDR uses a YAML configuration file and supports environment variables for customization.</p>"},{"location":"getting-started/configuration/#configuration-file","title":"Configuration File","text":"<p>The default configuration file is located at <code>~/.cmdr/config.yaml</code>. You can specify a different location using the <code>-c</code> or <code>--config</code> flag.</p> <pre><code>cmdr --config /path/to/config.yaml &lt;command&gt;\n</code></pre>"},{"location":"getting-started/configuration/#managing-configuration","title":"Managing Configuration","text":""},{"location":"getting-started/configuration/#view-configuration","title":"View Configuration","text":"<p>List all configuration values:</p> <pre><code>cmdr config list\n</code></pre> <p>Get a specific value:</p> <pre><code>cmdr config get -k &lt;key&gt;\n</code></pre>"},{"location":"getting-started/configuration/#set-configuration","title":"Set Configuration","text":"<pre><code>cmdr config set -k &lt;key&gt; -v &lt;value&gt;\n</code></pre>"},{"location":"getting-started/configuration/#configuration-keys","title":"Configuration Keys","text":""},{"location":"getting-started/configuration/#core-settings","title":"Core Settings","text":"Key Default Description <code>core.root_dir</code> <code>~/.cmdr</code> Root directory for CMDR data<sup>1</sup> <code>core.bin_dir</code> <code>bin</code> Directory for command binaries (relative to root) <code>core.shims_dir</code> <code>shims</code> Directory for shim scripts (relative to root) <code>core.profile_dir</code> <code>profile</code> Directory for shell profile scripts (relative to root) <code>core.database_path</code> <code>cmdr.db</code> Path to command database (relative to root) <code>core.link_mode</code> - How to link commands (symlink vs copy)"},{"location":"getting-started/configuration/#logging","title":"Logging","text":"Key Default Description <code>log.level</code> <code>info</code> Log level: <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code><sup>2</sup> <code>log.output</code> <code>stderr</code> Log output: <code>stdout</code> or <code>stderr</code>"},{"location":"getting-started/configuration/#proxy-settings","title":"Proxy Settings","text":"Key Description <code>proxy.go</code> Go module proxy URL <code>proxy.http</code> HTTP proxy URL <code>proxy.https</code> HTTPS proxy URL"},{"location":"getting-started/configuration/#download-settings","title":"Download Settings","text":"Key Description <code>download.replace</code> URL replacement pattern for proxying downloads <code>download.direct.timeout</code> Timeout for direct downloads <code>download.direct.max_retries</code> Maximum retry attempts <code>download.proxy.enabled</code> Enable download proxy <code>download.proxy.type</code> Proxy type <code>download.proxy.address</code> Proxy address"},{"location":"getting-started/configuration/#environment-variables","title":"Environment Variables","text":"<p>All configuration keys can be set via environment variables using <code>CMDR_</code> prefix and replacing <code>.</code> with <code>_</code><sup>3</sup>:</p> <pre><code># Set log level via environment\nexport CMDR_LOG_LEVEL=debug\n\n# Set root directory\nexport CMDR_CORE_ROOT_DIR=/custom/path\n</code></pre>"},{"location":"getting-started/configuration/#url-replacement","title":"URL Replacement","text":"<p>The URL replacement feature allows you to redirect downloads through a proxy server. This is useful for:</p> <ul> <li>Speeding up downloads in regions with slow GitHub access</li> <li>Using internal mirrors</li> </ul>"},{"location":"getting-started/configuration/#configuration_1","title":"Configuration","text":"<p>Set a replacement pattern using JSON:</p> <pre><code>cmdr config set -k download.replace -v '{\"match\": \"^https://raw.githubusercontent.com/.*$\", \"template\": \"https://ghproxy.com/{{ .input | urlquery }}\"}'\n</code></pre>"},{"location":"getting-started/configuration/#example-usage","title":"Example Usage","text":"<pre><code># After configuring URL replacement\ncmdr command install -n install.sh -v 0.0.0 -l https://raw.githubusercontent.com/MrLYC/cmdr/master/install.sh\n# The URL is automatically rewritten to use the proxy\n</code></pre>"},{"location":"getting-started/configuration/#sample-configuration-file","title":"Sample Configuration File","text":"<pre><code># ~/.cmdr/config.yaml\n\ncore:\n  root_dir: ~/.cmdr\n  bin_dir: bin\n  shims_dir: shims\n  profile_dir: profile\n  database_path: cmdr.db\n\nlog:\n  level: info\n  output: stderr\n\nproxy:\n  go: https://goproxy.cn,direct\n  http: \"\"\n  https: \"\"\n\ndownload:\n  replace:\n    match: \"^https://raw.githubusercontent.com/.*$\"\n    template: \"https://ghproxy.com/{{ .input | urlquery }}\"\n</code></pre> <ol> <li> <p>Configuration keys defined in <code>core/config.go</code> L23-L33\u00a0\u21a9</p> </li> <li> <p>Log initialization in <code>cmd/root.go</code> L130-L145\u00a0\u21a9</p> </li> <li> <p>Environment variable binding in <code>cmd/root.go</code> L67-L71\u00a0\u21a9</p> </li> </ol>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>This guide covers how to install CMDR on your system.</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>A Unix-like operating system (Linux, macOS)</li> <li>Bash, Zsh, or compatible shell</li> <li><code>curl</code> for script installation</li> </ul>"},{"location":"getting-started/installation/#quick-install-recommended","title":"Quick Install (Recommended)","text":"<p>Run the following command to install the latest version of CMDR:</p> <pre><code>curl -o- https://raw.githubusercontent.com/MrLYC/cmdr/master/install.sh | ${SHELL:-bash}\n</code></pre>"},{"location":"getting-started/installation/#for-users-in-china","title":"For Users in China","text":"<p>Speed up the installation using the proxy option:</p> <pre><code>curl -o- https://raw.githubusercontent.com/MrLYC/cmdr/master/install.sh | bash -s -p\n</code></pre>"},{"location":"getting-started/installation/#manual-installation","title":"Manual Installation","text":"<p>If you prefer manual installation or need more control:</p> <ol> <li> <p>Download the latest release from GitHub Releases</p> </li> <li> <p>Make the binary executable:    <pre><code>chmod +x /path/to/cmdr\n</code></pre></p> </li> <li> <p>Initialize CMDR:    <pre><code>/path/to/cmdr init\n</code></pre></p> </li> <li> <p>Restart your shell and verify:    <pre><code>cmdr version\n</code></pre></p> </li> </ol>"},{"location":"getting-started/installation/#what-the-installer-does","title":"What the Installer Does","text":"<p>The installation script performs these steps<sup>1</sup>:</p> <ol> <li>Detects your OS and architecture</li> <li>Downloads the appropriate binary from GitHub releases</li> <li>Places the binary in a configured location</li> <li>Runs <code>cmdr init</code> to set up the environment</li> <li>Configures the shell profile for PATH integration</li> </ol>"},{"location":"getting-started/installation/#directory-structure","title":"Directory Structure","text":"<p>After installation, CMDR creates the following directory structure<sup>2</sup>:</p> <pre><code>~/.cmdr/\n\u251c\u2500\u2500 bin/           # Managed command binaries\n\u251c\u2500\u2500 shims/         # Shim scripts for version switching\n\u251c\u2500\u2500 profile/       # Shell initialization scripts\n\u251c\u2500\u2500 config.yaml    # Configuration file\n\u2514\u2500\u2500 cmdr.db        # Command database\n</code></pre>"},{"location":"getting-started/installation/#verifying-installation","title":"Verifying Installation","text":"<p>After installation, verify everything is working:</p> <pre><code># Check CMDR version\ncmdr version\n\n# Check system status\ncmdr doctor\n</code></pre>"},{"location":"getting-started/installation/#uninstalling","title":"Uninstalling","text":"<p>To uninstall CMDR:</p> <ol> <li> <p>Remove the CMDR directory:    <pre><code>rm -rf ~/.cmdr\n</code></pre></p> </li> <li> <p>Remove the CMDR source line from your shell profile (<code>.bashrc</code>, <code>.zshrc</code>, etc.)</p> </li> </ol> <ol> <li> <p>Installation script: <code>install.sh</code> \u21a9</p> </li> <li> <p>Default paths configured in <code>cmd/root.go</code> L73-L77\u00a0\u21a9</p> </li> </ol>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>This guide will help you get started with CMDR in just a few minutes.</p>"},{"location":"getting-started/quick-start/#installing-your-first-command","title":"Installing Your First Command","text":"<p>Let's install a command version. CMDR can download from URLs or use local files:</p> <pre><code># Install from URL\ncmdr command install -n &lt;command-name&gt; -v &lt;version&gt; -l &lt;url-or-path&gt;\n\n# Example: Install a specific script\ncmdr command install -n hello -v 1.0.0 -l /usr/local/bin/hello\n</code></pre>"},{"location":"getting-started/quick-start/#flags-explained","title":"Flags Explained","text":"Flag Long Form Description <code>-n</code> <code>--name</code> Name of the command <code>-v</code> <code>--version</code> Version string (semantic versioning recommended) <code>-l</code> <code>--location</code> URL or file path to command binary"},{"location":"getting-started/quick-start/#listing-installed-commands","title":"Listing Installed Commands","text":"<p>View all versions of a specific command:</p> <pre><code>cmdr command list -n &lt;command-name&gt;\n</code></pre> <p>View all managed commands:</p> <pre><code>cmdr command list\n</code></pre>"},{"location":"getting-started/quick-start/#switching-versions","title":"Switching Versions","text":"<p>Activate a specific version of a command:</p> <pre><code>cmdr command use -n &lt;command-name&gt; -v &lt;version&gt;\n</code></pre> <p>After running this, the command will point to the specified version.</p>"},{"location":"getting-started/quick-start/#removing-commands","title":"Removing Commands","text":"<p>Remove a specific version:</p> <pre><code>cmdr command remove -n &lt;command-name&gt; -v &lt;version&gt;\n</code></pre>"},{"location":"getting-started/quick-start/#practical-example","title":"Practical Example","text":"<p>Let's walk through managing multiple versions of a tool:</p> <pre><code># 1. Install version 1.0.0\ncmdr command install -n mytool -v 1.0.0 -l https://example.com/mytool-1.0.0\n\n# 2. Install version 2.0.0\ncmdr command install -n mytool -v 2.0.0 -l https://example.com/mytool-2.0.0\n\n# 3. List all installed versions\ncmdr command list -n mytool\n\n# 4. Use version 1.0.0\ncmdr command use -n mytool -v 1.0.0\n\n# 5. Verify\nmytool --version  # Should show 1.0.0\n\n# 6. Switch to version 2.0.0\ncmdr command use -n mytool -v 2.0.0\n\n# 7. Verify again\nmytool --version  # Should show 2.0.0\n</code></pre>"},{"location":"getting-started/quick-start/#how-version-switching-works","title":"How Version Switching Works","text":"<p>When you run <code>cmdr command use</code>, CMDR:</p> <ol> <li>Looks up the command in its database<sup>1</sup></li> <li>Creates or updates a shim script in <code>~/.cmdr/shims/</code><sup>2</sup></li> <li>The shim redirects to the actual binary location</li> </ol> <p>Since <code>~/.cmdr/shims</code> is in your PATH, running the command name executes the shim, which runs the correct version.</p>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Configure CMDR - Customize behavior with configuration</li> <li>Architecture Overview - Understand how CMDR works internally</li> </ul> <ol> <li> <p>Command query in <code>core/command.go</code> L25-L34\u00a0\u21a9</p> </li> <li> <p>Shim management in <code>core/strategy/</code> \u21a9</p> </li> </ol>"},{"location":"operations/build-and-test/","title":"Build &amp; Test","text":"<p>This document describes how to build, test, and develop CMDR.</p>"},{"location":"operations/build-and-test/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.25 or later</li> <li>Make (optional, for convenience commands)</li> <li>Git</li> </ul>"},{"location":"operations/build-and-test/#building-from-source","title":"Building from Source","text":""},{"location":"operations/build-and-test/#clone-repository","title":"Clone Repository","text":"<pre><code>git clone https://github.com/mrlyc/cmdr.git\ncd cmdr\n</code></pre>"},{"location":"operations/build-and-test/#build-binary","title":"Build Binary","text":"<pre><code># Using go build\ngo build -o cmdr main.go\n\n# Or using make\nmake build\n</code></pre> <p>The binary will be created in the current directory.</p>"},{"location":"operations/build-and-test/#install-locally","title":"Install Locally","text":"<pre><code># Build and initialize\ngo build -o cmdr main.go\n./cmdr init\n</code></pre>"},{"location":"operations/build-and-test/#running-tests","title":"Running Tests","text":""},{"location":"operations/build-and-test/#unit-tests","title":"Unit Tests","text":"<pre><code># Run all tests\ngo test ./...\n\n# Run tests with coverage\ngo test ./... -coverprofile=coverage.out\n\n# View coverage report\ngo tool cover -html=coverage.out\n</code></pre>"},{"location":"operations/build-and-test/#integration-tests","title":"Integration Tests","text":"<p>CMDR has integration tests in the <code>integration-tests/</code> directory:</p> <pre><code>cd integration-tests\n./start.sh\n</code></pre> <p>What Integration Tests Do:</p> <ol> <li>Build CMDR binary</li> <li>Run <code>cmdr init</code></li> <li>Install test commands</li> <li>Verify command activation</li> <li>Test upgrade functionality</li> <li>Clean up</li> </ol> <p>Environment Variables:</p> Variable Description <code>SKIP_INSTALL</code> Skip installation step (for CI) <code>CMDR_CORE_ROOT_DIR</code> Override CMDR root directory <code>CMDR_CORE_PROFILE_DIR</code> Override profile directory"},{"location":"operations/build-and-test/#development-workflow","title":"Development Workflow","text":""},{"location":"operations/build-and-test/#project-structure","title":"Project Structure","text":"<pre><code>cmdr/\n\u251c\u2500\u2500 cmd/                    # CLI commands\n\u2502   \u251c\u2500\u2500 root.go            # Root command &amp; initialization\n\u2502   \u251c\u2500\u2500 command/           # command subcommands\n\u2502   \u251c\u2500\u2500 config/            # config subcommands\n\u2502   \u251c\u2500\u2500 init.go            # init command\n\u2502   \u251c\u2500\u2500 upgrade.go         # upgrade command\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 core/                   # Core business logic\n\u2502   \u251c\u2500\u2500 command.go         # Command interface\n\u2502   \u251c\u2500\u2500 initializer.go     # Initializer interface\n\u2502   \u251c\u2500\u2500 config.go          # Configuration keys\n\u2502   \u251c\u2500\u2500 manager/           # CommandManager implementations\n\u2502   \u251c\u2500\u2500 initializer/       # Initializer implementations\n\u2502   \u251c\u2500\u2500 strategy/          # Download strategies\n\u2502   \u251c\u2500\u2500 fetcher/           # File fetchers\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 integration-tests/      # Integration test scripts\n\u251c\u2500\u2500 main.go                # Application entry point\n\u251c\u2500\u2500 go.mod                 # Go module definition\n\u251c\u2500\u2500 Makefile               # Build automation\n\u2514\u2500\u2500 README.md\n</code></pre>"},{"location":"operations/build-and-test/#code-generation","title":"Code Generation","text":"<p>CMDR uses go:generate for code generation:</p> <pre><code># Generate string methods for enums\ngo generate ./...\n</code></pre> <p>Generated files: - <code>*_string.go</code> - String methods for enum types (via stringer) - <code>mock/*.go</code> - Mock implementations (via mockgen)</p>"},{"location":"operations/build-and-test/#adding-a-new-command","title":"Adding a New Command","text":"<ol> <li>Create command file in <code>cmd/</code> or <code>cmd/&lt;subcommand&gt;/</code>:</li> </ol> <pre><code>// cmd/mycommand.go\npackage cmd\n\nimport (\n    \"github.com/spf13/cobra\"\n    \"github.com/mrlyc/cmdr/core\"\n)\n\nvar myCmd = &amp;cobra.Command{\n    Use:   \"my-command\",\n    Short: \"Description\",\n    Run: func(cmd *cobra.Command, args []string) {\n        // Implementation\n    },\n}\n\nfunc init() {\n    rootCmd.AddCommand(myCmd)\n\n    // Add flags\n    myCmd.Flags().StringP(\"flag\", \"f\", \"\", \"flag description\")\n\n    // Bind to configuration\n    cfg := core.GetConfiguration()\n    cfg.BindPFlag(\"my.flag\", myCmd.Flags().Lookup(\"flag\"))\n}\n</code></pre> <ol> <li> <p>Register with root command in <code>init()</code></p> </li> <li> <p>Add tests in <code>cmd/*_test.go</code></p> </li> </ol>"},{"location":"operations/build-and-test/#adding-a-new-manager","title":"Adding a New Manager","text":"<ol> <li>Create manager file in <code>core/manager/</code>:</li> </ol> <pre><code>// core/manager/custom.go\npackage manager\n\nimport \"github.com/mrlyc/cmdr/core\"\n\ntype CustomManager struct {\n    manager core.CommandManager // Wrapped manager\n}\n\nfunc (m *CustomManager) Define(name, version, location string) (core.Command, error) {\n    // Custom logic\n    return m.manager.Define(name, version, location)\n}\n\n// Implement other CommandManager methods...\n\nfunc init() {\n    core.RegisterCommandManagerFactory(core.CommandProviderCustom, func(cfg core.Configuration) (core.CommandManager, error) {\n        // Get wrapped manager\n        wrapped, _ := core.NewCommandManager(core.CommandProviderBinary, cfg)\n        return &amp;CustomManager{manager: wrapped}, nil\n    })\n}\n</code></pre> <ol> <li> <p>Add provider constant in <code>core/command.go</code></p> </li> <li> <p>Add tests in <code>core/manager/custom_test.go</code></p> </li> </ol>"},{"location":"operations/build-and-test/#testing-guidelines","title":"Testing Guidelines","text":""},{"location":"operations/build-and-test/#unit-test-structure","title":"Unit Test Structure","text":"<pre><code>package manager_test\n\nimport (\n    \"testing\"\n    \"github.com/onsi/ginkgo\"\n    \"github.com/onsi/gomega\"\n)\n\nfunc TestManager(t *testing.T) {\n    gomega.RegisterFailHandler(ginkgo.Fail)\n    ginkgo.RunSpecs(t, \"Manager Suite\")\n}\n\nvar _ = ginkgo.Describe(\"CustomManager\", func() {\n    var manager *manager.CustomManager\n\n    ginkgo.BeforeEach(func() {\n        cfg := core.NewConfiguration()\n        manager, _ = manager.NewCustomManager(cfg)\n    })\n\n    ginkgo.AfterEach(func() {\n        manager.Close()\n    })\n\n    ginkgo.It(\"should define command\", func() {\n        cmd, err := manager.Define(\"test\", \"1.0.0\", \"/path/to/bin\")\n        gomega.Expect(err).ToNot(gomega.HaveOccurred())\n        gomega.Expect(cmd.GetName()).To(gomega.Equal(\"test\"))\n    })\n})\n</code></pre>"},{"location":"operations/build-and-test/#running-specific-tests","title":"Running Specific Tests","text":"<pre><code># Run specific package\ngo test ./core/manager/...\n\n# Run specific test\ngo test ./core/manager/ -run TestDatabaseManager\n\n# Run with verbose output\ngo test ./... -v\n\n# Run with race detector\ngo test ./... -race\n</code></pre>"},{"location":"operations/build-and-test/#debugging","title":"Debugging","text":""},{"location":"operations/build-and-test/#enable-debug-logging","title":"Enable Debug Logging","text":"<pre><code># Via environment variable\nexport CMDR_LOG_LEVEL=debug\ncmdr command list\n\n# Via config flag\ncmdr --config /path/to/debug-config.yaml command list\n</code></pre>"},{"location":"operations/build-and-test/#inspect-database","title":"Inspect Database","text":"<pre><code># Install BoltDB browser\ngo install github.com/br0xen/boltbrowser@latest\n\n# Open database\nboltbrowser ~/.cmdr/cmdr.db\n</code></pre>"},{"location":"operations/build-and-test/#check-directory-structure","title":"Check Directory Structure","text":"<pre><code># List all managed files\ntree ~/.cmdr\n\n# Check symlinks\nls -la ~/.cmdr/bin/\nls -la ~/.cmdr/shims/\n</code></pre>"},{"location":"operations/build-and-test/#cicd","title":"CI/CD","text":""},{"location":"operations/build-and-test/#github-actions-workflows","title":"GitHub Actions Workflows","text":"<p>CMDR uses GitHub Actions for CI/CD:</p> Workflow Trigger Purpose <code>unittest.yml</code> Push, PR Run unit tests on multiple Go versions <code>integration-test.yml</code> Push, PR Run integration tests <code>release.yml</code> Tag push Build and publish releases <code>codeql-analysis.yml</code> Schedule, PR Security analysis <p>Workflow Files: <code>.github/workflows/</code></p>"},{"location":"operations/build-and-test/#running-ci-locally","title":"Running CI Locally","text":"<pre><code># Unit tests (matches CI)\ngo test ./... -race -coverprofile=coverage.out\n\n# Integration tests (matches CI)\nexport SKIP_INSTALL=true\nexport CMDR_CORE_ROOT_DIR=$PWD/.cmdr-test\nexport CMDR_CORE_PROFILE_DIR=$PWD/.cmdr-test/profile\ncd integration-tests &amp;&amp; ./start.sh\n</code></pre>"},{"location":"operations/build-and-test/#performance-profiling","title":"Performance Profiling","text":""},{"location":"operations/build-and-test/#cpu-profiling","title":"CPU Profiling","text":"<pre><code># Build with profiling\ngo test -cpuprofile cpu.prof -bench=. ./core/manager/\n\n# Analyze profile\ngo tool pprof cpu.prof\n</code></pre>"},{"location":"operations/build-and-test/#memory-profiling","title":"Memory Profiling","text":"<pre><code># Build with profiling\ngo test -memprofile mem.prof -bench=. ./core/manager/\n\n# Analyze profile\ngo tool pprof mem.prof\n</code></pre>"},{"location":"operations/build-and-test/#code-quality","title":"Code Quality","text":""},{"location":"operations/build-and-test/#linting","title":"Linting","text":"<pre><code># Install golangci-lint\ngo install github.com/golangci/golangci-lint/cmd/golangci-lint@latest\n\n# Run linters\ngolangci-lint run ./...\n</code></pre>"},{"location":"operations/build-and-test/#formatting","title":"Formatting","text":"<pre><code># Format code\ngo fmt ./...\n\n# Or using gofmt\ngofmt -w .\n</code></pre>"},{"location":"operations/build-and-test/#vet","title":"Vet","text":"<pre><code># Static analysis\ngo vet ./...\n</code></pre>"},{"location":"operations/release/","title":"Release","text":"<p>This document describes the release process for CMDR.</p>"},{"location":"operations/release/#release-strategy","title":"Release Strategy","text":"<p>CMDR follows semantic versioning (SemVer):</p> <ul> <li>Major (vX.0.0): Breaking changes</li> <li>Minor (vX.Y.0): New features, backward compatible</li> <li>Patch (vX.Y.Z): Bug fixes, backward compatible</li> </ul>"},{"location":"operations/release/#release-process","title":"Release Process","text":""},{"location":"operations/release/#1-prepare-release","title":"1. Prepare Release","text":"<pre><code># Ensure you're on master branch\ngit checkout master\ngit pull origin master\n\n# Run all tests\ngo test ./...\ncd integration-tests &amp;&amp; ./start.sh &amp;&amp; cd ..\n\n# Update version references if needed\n# (Currently version is determined by git tags)\n</code></pre>"},{"location":"operations/release/#2-create-release-tag","title":"2. Create Release Tag","text":"<pre><code># Create annotated tag\ngit tag -a v1.2.3 -m \"Release v1.2.3: Description of changes\"\n\n# Push tag to trigger release workflow\ngit push origin v1.2.3\n</code></pre>"},{"location":"operations/release/#3-automated-build","title":"3. Automated Build","text":"<p>The GitHub Actions <code>release.yml</code> workflow automatically:</p> <ol> <li>Builds binaries for multiple platforms:</li> <li>Linux (amd64, arm64)</li> <li>macOS (amd64, arm64)</li> <li> <p>Windows (amd64)</p> </li> <li> <p>Creates GitHub release with:</p> </li> <li>Release notes</li> <li>Pre-built binaries</li> <li> <p>Checksums</p> </li> <li> <p>Publishes release assets</p> </li> </ol> <p>Workflow: <code>.github/workflows/release.yml</code></p>"},{"location":"operations/release/#goreleaser-configuration","title":"GoReleaser Configuration","text":"<p>CMDR uses GoReleaser for building and publishing releases.</p> <p>Configuration: <code>.goreleaser.yml</code></p>"},{"location":"operations/release/#build-configuration","title":"Build Configuration","text":"<pre><code># .goreleaser.yml\nbuilds:\n  - env:\n      - CGO_ENABLED=0\n    goos:\n      - linux\n      - darwin\n      - windows\n    goarch:\n      - amd64\n      - arm64\n    ldflags:\n      - -s -w -X main.version={{.Version}}\n</code></pre>"},{"location":"operations/release/#archive-configuration","title":"Archive Configuration","text":"<pre><code>archives:\n  - format: tar.gz\n    name_template: \"cmdr_{{ .Version }}_{{ .Os }}_{{ .Arch }}\"\n    format_overrides:\n      - goos: windows\n        format: zip\n</code></pre>"},{"location":"operations/release/#release-checklist","title":"Release Checklist","text":"<p>Before creating a release:</p> <ul> <li>[ ] All tests pass (<code>go test ./...</code>)</li> <li>[ ] Integration tests pass (<code>integration-tests/start.sh</code>)</li> <li>[ ] Code is linted (<code>golangci-lint run</code>)</li> <li>[ ] CHANGELOG updated (if maintaining one)</li> <li>[ ] Documentation updated</li> <li>[ ] No breaking changes (or major version bump)</li> </ul>"},{"location":"operations/release/#manual-release-if-needed","title":"Manual Release (If Needed)","text":"<p>If automated release fails, build manually:</p> <pre><code># Install GoReleaser\ngo install github.com/goreleaser/goreleaser@latest\n\n# Build release (dry run)\ngoreleaser release --snapshot --rm-dist\n\n# Build actual release\nexport GITHUB_TOKEN=your_token\ngoreleaser release --rm-dist\n</code></pre>"},{"location":"operations/release/#release-assets","title":"Release Assets","text":"<p>Each release includes:</p>"},{"location":"operations/release/#binaries","title":"Binaries","text":"Asset Platform Architecture <code>cmdr_vX.Y.Z_linux_amd64.tar.gz</code> Linux x86_64 <code>cmdr_vX.Y.Z_linux_arm64.tar.gz</code> Linux ARM64 <code>cmdr_vX.Y.Z_darwin_amd64.tar.gz</code> macOS Intel <code>cmdr_vX.Y.Z_darwin_arm64.tar.gz</code> macOS Apple Silicon <code>cmdr_vX.Y.Z_windows_amd64.zip</code> Windows x86_64"},{"location":"operations/release/#checksums","title":"Checksums","text":"<ul> <li><code>checksums.txt</code> - SHA256 checksums of all assets</li> </ul>"},{"location":"operations/release/#upgrading-cmdr","title":"Upgrading CMDR","text":"<p>Users can upgrade using the built-in command:</p> <pre><code>cmdr upgrade\n\n# Or specific version\ncmdr upgrade --release v1.2.3\n</code></pre> <p>The upgrade process:</p> <ol> <li>Queries GitHub API for latest release (or specified version)</li> <li>Downloads appropriate binary for current platform</li> <li>Replaces current binary</li> <li>Runs <code>cmdr init --upgrade</code> to update profile</li> </ol> <p>Implementation: <code>cmd/upgrade.go</code></p>"},{"location":"operations/release/#version-detection","title":"Version Detection","text":"<p>CMDR detects its version from:</p> <ol> <li>Build-time ldflags (<code>-X main.version=...</code>)</li> <li>Git tags (if built from source)</li> </ol> <p>Display version:</p> <pre><code>cmdr version\n</code></pre>"},{"location":"operations/release/#pre-release-versions","title":"Pre-Release Versions","text":"<p>For testing before official release:</p> <pre><code># Create pre-release tag\ngit tag -a v1.2.3-rc.1 -m \"Release candidate 1\"\ngit push origin v1.2.3-rc.1\n</code></pre> <p>GoReleaser will mark it as \"pre-release\" on GitHub.</p>"},{"location":"operations/release/#hotfix-process","title":"Hotfix Process","text":"<p>For critical bugs in released versions:</p> <ol> <li> <p>Create hotfix branch from tag:    <pre><code>git checkout -b hotfix/v1.2.4 v1.2.3\n</code></pre></p> </li> <li> <p>Fix bug and commit:    <pre><code>git commit -m \"fix: critical bug description\"\n</code></pre></p> </li> <li> <p>Create patch release:    <pre><code>git tag -a v1.2.4 -m \"Hotfix v1.2.4: Fix critical bug\"\ngit push origin v1.2.4\n</code></pre></p> </li> <li> <p>Merge back to master:    <pre><code>git checkout master\ngit merge hotfix/v1.2.4\ngit push origin master\n</code></pre></p> </li> </ol>"},{"location":"operations/release/#release-announcement","title":"Release Announcement","text":"<p>After release is published:</p> <ol> <li>GitHub Release Notes: Auto-generated from commits or manually edited</li> <li>README Badge: Automatically updated to show latest version</li> <li>Documentation: Update if needed</li> </ol>"},{"location":"operations/release/#troubleshooting-releases","title":"Troubleshooting Releases","text":""},{"location":"operations/release/#build-fails","title":"Build Fails","text":"<p>Check <code>.github/workflows/release.yml</code> logs for errors:</p> <pre><code># Common issues:\n# - Go version mismatch\n# - Missing dependencies\n# - Linting failures\n</code></pre>"},{"location":"operations/release/#goreleaser-fails","title":"GoReleaser Fails","text":"<pre><code># Test locally\ngoreleaser release --snapshot --rm-dist\n\n# Check configuration\ngoreleaser check\n</code></pre>"},{"location":"operations/release/#binary-not-working","title":"Binary Not Working","text":"<pre><code># Verify binary is executable\nchmod +x cmdr\n\n# Check if it's for correct platform\nfile cmdr\n\n# Test locally before release\n./cmdr version\n</code></pre>"},{"location":"operations/release/#security-considerations","title":"Security Considerations","text":""},{"location":"operations/release/#signing-releases","title":"Signing Releases","text":"<p>Currently, releases are not signed. To add signing:</p> <ol> <li>Generate GPG key</li> <li>Add key to GoReleaser config</li> <li>Upload public key to GitHub</li> </ol>"},{"location":"operations/release/#checksum-verification","title":"Checksum Verification","text":"<p>Users should verify checksums:</p> <pre><code># Download checksum file\ncurl -LO https://github.com/mrlyc/cmdr/releases/download/v1.2.3/checksums.txt\n\n# Verify binary\nsha256sum -c checksums.txt --ignore-missing\n</code></pre>"},{"location":"operations/release/#rollback","title":"Rollback","text":"<p>If a release has critical issues:</p> <ol> <li>Mark as Pre-release: Edit GitHub release, check \"This is a pre-release\"</li> <li>Delete Tag (if not yet widely distributed):    <pre><code>git tag -d v1.2.3\ngit push origin :refs/tags/v1.2.3\n</code></pre></li> <li>Create Patch Release: Follow hotfix process</li> </ol>"},{"location":"operations/release/#future-improvements","title":"Future Improvements","text":"<p>Potential enhancements to release process:</p> <ul> <li>[ ] Automated changelog generation from commits</li> <li>[ ] GPG signing of release binaries</li> <li>[ ] Docker image publishing</li> <li>[ ] Homebrew formula auto-update</li> <li>[ ] Release announcement automation</li> </ul>"}]}